import{r as a,j as e,S as Ie,n as x,u as ns,a as rs,U as we,b as os,L as Re,F as ds,A as cs,c as ps,d as ms,e as oe,f as us,g as hs,p as gs,t as xs,s as ys,l as js,h as bs,C as vs,P as fs,D as Ns,R as de,i as Cs,k as Ss,m as Ts,o as Ae,q as ce,v as ks,w as Is,x as ws}from"./index-3pZLK3h4.js";import{t as Rs,a as As}from"./training-DREbPuWc.js";import{s as _e}from"./pii-BcFV6mqh.js";function _s(c){return!Array.isArray(c)||!c.length?"":c.filter(Boolean).map(n=>String(n)).join(`
`)}function Us({token:c}){const[n,E]=a.useState(!1),[P,p]=a.useState([]),[U,W]=a.useState(!1);function O(l){const m=(Array.isArray(l)?l:[]).map(h=>String(h||"").trim()).filter(Boolean);return m.length?m:[""]}const[u,f]=a.useState({training_id:"",name:"",department:"",description:"",video_links:[""],documentsLines:""});async function N(){E(!0);try{const l=await Rs(c);p(l.items??[])}catch(l){x.error((l==null?void 0:l.message)||"Failed to load trainings")}finally{E(!1)}}a.useEffect(()=>{N()},[]);const T=a.useMemo(()=>!!String(u.name||"").trim()&&!!String(u.department||"").trim(),[u]);async function I(l){var d;if((d=l==null?void 0:l.preventDefault)==null||d.call(l),!T){x.error("Name and Department are required");return}W(!0);try{const m=O(u.video_links).filter(Boolean),h={training_id:String(u.training_id||"").trim()||void 0,name:String(u.name||"").trim(),department:String(u.department||"").trim(),description:String(u.description||"").trim(),video_links:m,documentsLines:String(u.documentsLines||"")},C=await As(c,h);x.success(h.training_id?"Training updated":"Training created"),f({training_id:"",name:"",department:"",description:"",video_links:[""],documentsLines:""}),await N(),C!=null&&C.training_id}catch(m){x.error((m==null?void 0:m.message)||"Save failed")}finally{W(!1)}}return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:0},children:"Training Builder (Templates)"}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsxs("button",{className:"button",type:"button",onClick:N,disabled:n,children:[n?e.jsx(Ie,{size:14}):null,"Refresh"]})})]}),e.jsx("div",{style:{height:10}}),e.jsxs("form",{onSubmit:I,className:"card",style:{background:"#fafafa"},children:[e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Training Name (e.g., CRM)",value:u.name,onChange:l=>f(d=>({...d,name:l.target.value})),style:{minWidth:220}}),e.jsx("input",{placeholder:"Department (e.g., Accounts)",value:u.department,onChange:l=>f(d=>({...d,department:l.target.value})),style:{minWidth:180}})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{children:[e.jsx("label",{className:"small",style:{fontWeight:700,display:"block",marginBottom:4},children:"Video URLs"}),e.jsx("div",{style:{display:"grid",gap:8},children:(u.video_links||[]).map((l,d)=>e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{placeholder:`Video URL ${d+1}`,value:l,onChange:m=>f(h=>({...h,video_links:(h.video_links||[]).map((C,v)=>v===d?m.target.value:C)})),style:{minWidth:240,flex:1}}),e.jsx("button",{className:"button",type:"button",disabled:U,onClick:()=>f(m=>({...m,video_links:[...m.video_links||[],""]})),children:"+ Add"}),e.jsx("button",{className:"button danger",type:"button",disabled:U||(u.video_links||[]).length<=1,onClick:()=>f(m=>{const h=(m.video_links||[]).filter((C,v)=>v!==d);return{...m,video_links:h.length?h:[""]}}),children:"Remove"})]},d))})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{children:[e.jsx("label",{className:"small",style:{fontWeight:700,display:"block",marginBottom:4},children:"Description"}),e.jsx("textarea",{value:u.description,onChange:l=>f(d=>({...d,description:l.target.value})),rows:3,style:{width:"100%"}})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{children:[e.jsx("label",{className:"small",style:{fontWeight:700,display:"block",marginBottom:4},children:"Documents (one URL or Drive fileId per line)"}),e.jsx("textarea",{value:u.documentsLines,onChange:l=>f(d=>({...d,documentsLines:l.target.value})),rows:3,style:{width:"100%"}})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{className:"button primary",type:"submit",disabled:U||!T,children:[U?e.jsx(Ie,{size:14}):null,u.training_id?"Update Template":"Create Template"]}),e.jsx("button",{className:"button",type:"button",onClick:()=>f({training_id:"",name:"",department:"",description:"",video_links:[""],documentsLines:""}),disabled:U,children:"Clear"})]})]}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:n?"Loading…":`${P.length} templates`}),e.jsx("div",{style:{height:10}}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:P.map(l=>e.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:[e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:220},children:[e.jsx("div",{style:{fontWeight:700},children:l.name}),e.jsx("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:l.department})]}),e.jsx("button",{className:"button",type:"button",onClick:()=>f({training_id:l.training_id,name:l.name||"",department:l.department||"",description:l.description||"",video_links:O(l.video_links||(l.video_link?[l.video_link]:[])),documentsLines:_s(l.documents)}),children:"Edit"})]}),Array.isArray(l.video_links)&&l.video_links.length?e.jsx("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:l.video_links.map((d,m)=>e.jsxs("button",{className:"button",type:"button",onClick:()=>window.open(d,"_blank","noopener,noreferrer"),children:["Open Video ",m+1]},d||m))}):l.video_link?e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"button",type:"button",onClick:()=>window.open(l.video_link,"_blank","noopener,noreferrer"),children:"Open Video"})}):null]},l.training_id))})]})}function y(c,n){x.error(n,{id:c})}function j(c,n){return c instanceof Ss?c.message||n:(c==null?void 0:c.message)??n}function Ue(c){if(!c)return"";const n=new Date(c),E=n.getFullYear(),P=String(n.getMonth()+1).padStart(2,"0"),p=String(n.getDate()).padStart(2,"0");return`${E}-${P}-${p}`}function Ws(){const c=ns(),{token:n,role:E}=rs(),P=a.useMemo(()=>[{key:"users",label:"Users",icon:we},{key:"roles",label:"Roles",icon:os},{key:"permissions",label:"Permissions",icon:Re},{key:"templates",label:"Job Templates",icon:ds},{key:"trainings",label:"Trainings",icon:cs},{key:"settings",label:"Settings",icon:ps},{key:"logs",label:"Logs",icon:ms},{key:"system",label:"System Health",icon:oe}],[]),[p,U]=a.useState("users"),[W,O]=a.useState([]),[u,f]=a.useState(!1),[N,T]=a.useState({email:"",fullName:"",role:"EA",active:!0}),[I,l]=a.useState([]),[d,m]=a.useState(!1),[h,C]=a.useState({roleCode:"",roleName:"",status:"ACTIVE"}),[v,Le]=a.useState([]),[D,pe]=a.useState(!1),[J,Ee]=a.useState(""),[q,Pe]=a.useState(""),[k,L]=a.useState({permType:"UI",permKey:"",rolesCsv:"",enabled:!0}),[R,We]=a.useState(""),[K,A]=a.useState(!1),[me,Fe]=a.useState([]),[Me,ue]=a.useState(!1),[b,S]=a.useState({templateId:null,jobRole:"",jobTitle:"",jd:"",responsibilities:"",skills:"",shift:"",payScale:"",perks:"",notes:"",active:!0}),[Oe,he]=a.useState(!1),[G,ge]=a.useState(!1),[xe,ye]=a.useState(6),[je,be]=a.useState(3),[ve,fe]=a.useState(""),[Ne,Ce]=a.useState(!1),[F,De]=a.useState("AUDIT"),[B,Ke]=a.useState(Ue(new Date(Date.now()-7*24*60*60*1e3))),[V,Be]=a.useState(Ue(new Date)),[Q,Ve]=a.useState(""),[X,$e]=a.useState(""),[Y,He]=a.useState(""),[Z,ze]=a.useState(""),[ee,Je]=a.useState(""),[se,qe]=a.useState(""),[Se,Ge]=a.useState([]),$=a.useCallback(async()=>{f(!0);try{const s=await us(n,{page:1,pageSize:500});O(s.items??[])}catch(s){y("admin_users_load",j(s,"Failed to load users"))}finally{f(!1)}},[n]),_=a.useCallback(async()=>{m(!0);try{const s=await hs(n,{includeInactive:!0});l(s.items??[])}catch(s){y("admin_roles_load",j(s,"Failed to load roles"))}finally{m(!1)}},[n]),w=a.useCallback(async()=>{pe(!0);try{const s=await gs(n);Le(s.items??[])}catch(s){y("admin_permissions_load",j(s,"Failed to load permissions"))}finally{pe(!1)}},[n]),te=a.useCallback(async()=>{ue(!0);try{const s=await xs(n,{page:1,pageSize:500});Fe(s.items??[])}catch(s){y("admin_templates_load",j(s,"Failed to load templates"))}finally{ue(!1)}},[n]),ae=a.useCallback(async()=>{he(!0);try{const t=(await ys(n)).items??[],i=t.find(o=>o.key==="PASSING_MARKS"),r=t.find(o=>o.key==="NOT_PICK_THRESHOLD"),g=t.find(o=>o.key==="INTERVIEW_MESSAGE_TEMPLATE");i&&ye(Number(i.value??6)),r&&be(Number(r.value??3)),g&&fe(String(g.value??""))}catch(s){y("admin_settings_load",j(s,"Failed to load settings"))}finally{he(!1)}},[n]),le=a.useCallback(async()=>{Ce(!0);try{const s=await js(n,{logType:F,from:B?new Date(B).toISOString():null,to:V?new Date(V+"T23:59:59").toISOString():null,stageTag:Q||null,actorRole:X||null,entityType:Y||null,entityId:Z||null,candidateId:ee||null,requirementId:se||null,page:1,pageSize:200});Ge(s.items??[])}catch(s){y("admin_logs_load",j(s,"Failed to load logs"))}finally{Ce(!1)}},[n,F,B,V,Q,X,Y,Z,ee,se]);a.useEffect(()=>{p==="users"&&$(),p==="users"&&_(),p==="roles"&&_(),p==="permissions"&&(_(),w()),p==="templates"&&te(),p==="settings"&&ae(),p==="logs"&&le()},[p,$,_,w,te,ae,le]);const ie=a.useMemo(()=>{const i=(Array.isArray(I)?I:[]).filter(r=>String(r.status||"").toUpperCase()==="ACTIVE").map(r=>String(r.roleCode||"").toUpperCase()).filter(Boolean);return i.length?i.sort():["ADMIN","EA","HR","OWNER"]},[I]);a.useMemo(()=>{const s={};for(const t of I||[])s[String(t.roleCode||"").toUpperCase()]=t;return s},[I]);const Te=a.useMemo(()=>{const s=Array.isArray(v)?v:[],t=String(J||"").toUpperCase().trim(),i=String(q||"").toUpperCase().trim();return s.filter(r=>!(t&&String(r.permType||"").toUpperCase()!==t||i&&!`${r.permType||""}:${r.permKey||""}:${r.rolesCsv||""}`.toUpperCase().includes(i)))},[v,J,q]);function ne(s){return String(s||"").split(",").map(t=>t.trim().toUpperCase()).filter(Boolean)}function ke(s){const t=Array.from(new Set((s||[]).map(i=>String(i||"").trim().toUpperCase()).filter(Boolean)));return t.sort(),t.join(",")}function H(s,t){return t?ne(s).includes(String(t).toUpperCase()):!1}function M(s,t){const i=ne(s);return i.push(String(t).toUpperCase()),ke(i)}function re(s,t){const i=String(t||"").toUpperCase(),r=ne(s).filter(g=>g!==i);return ke(r)}async function z(s){const t=Array.isArray(s)?s:[],i=200;for(let r=0;r<t.length;r+=i)await ce(n,t.slice(r,r+i))}async function Qe(s,t,i){const r=String(t||"").toUpperCase().trim();if(r){A(!0);try{const g=i?M(s.rolesCsv,r):re(s.rolesCsv,r);await ce(n,[{permType:String(s.permType||"").toUpperCase(),permKey:String(s.permKey||"").toUpperCase(),rolesCsv:g,enabled:!!s.enabled}]),await w()}catch(g){y("admin_perm_quick_toggle",j(g,"Failed to update permission"))}finally{A(!1)}}}async function Xe(){A(!0);try{await Ae(n,{roleCode:"MIS",roleName:"MIS",status:"ACTIVE"}),await _();const s=Array.isArray(v)?v:[],t=[];for(const i of s)H(i.rolesCsv,"MIS")&&t.push({permType:String(i.permType||"").toUpperCase(),permKey:String(i.permKey||"").toUpperCase(),rolesCsv:re(i.rolesCsv,"MIS"),enabled:!!i.enabled});t.length&&await z(t),await z([{permType:"UI",permKey:"PORTAL_TESTS",rolesCsv:M("","MIS"),enabled:!0},{permType:"ACTION",permKey:"TESTS_QUEUE_LIST",rolesCsv:M("","MIS"),enabled:!0},{permType:"ACTION",permKey:"CANDIDATE_TEST_SUBMIT",rolesCsv:M("","MIS"),enabled:!0}]),await w(),x.success("MIS preset applied (Excel only)")}catch(s){y("admin_perm_preset_mis",j(s,"Failed to apply MIS preset"))}finally{A(!1)}}async function Ye(s){const t=String(s||"").toUpperCase().trim();if(t){A(!0);try{const g=(Array.isArray(v)?v:[]).filter(o=>String(o.permType||"").toUpperCase()==="UI"&&String(o.permKey||"").toUpperCase().startsWith("PORTAL_")).filter(o=>!H(o.rolesCsv,t)).map(o=>({permType:"UI",permKey:String(o.permKey||"").toUpperCase(),rolesCsv:M(o.rolesCsv,t),enabled:!!o.enabled}));g.length&&await z(g),await w(),x.success("Portals granted")}catch(i){y("admin_perm_grant_portals",j(i,"Failed to grant portals"))}finally{A(!1)}}}async function Ze(s){const t=String(s||"").toUpperCase().trim();if(t){A(!0);try{const g=(Array.isArray(v)?v:[]).filter(o=>String(o.permType||"").toUpperCase()==="UI"&&String(o.permKey||"").toUpperCase().startsWith("PORTAL_")).filter(o=>H(o.rolesCsv,t)).map(o=>({permType:"UI",permKey:String(o.permKey||"").toUpperCase(),rolesCsv:re(o.rolesCsv,t),enabled:!!o.enabled}));g.length&&await z(g),await w(),x.success("Portals revoked")}catch(i){y("admin_perm_revoke_portals",j(i,"Failed to revoke portals"))}finally{A(!1)}}}async function es(s){if(s.preventDefault(),!(!N.email||!N.role))try{await Ts(n,N),x.success("User saved"),T({email:"",fullName:"",role:"EA",active:!0}),await $()}catch(t){y("admin_user_save",j(t,"Failed to save user"))}}async function ss(s){s.preventDefault();const t=String(h.roleCode||"").toUpperCase().trim();if(t)try{await Ae(n,{roleCode:t,roleName:String(h.roleName||"").trim()||t,status:String(h.status||"ACTIVE").toUpperCase().trim()}),x.success("Role saved"),C({roleCode:"",roleName:"",status:"ACTIVE"}),await _()}catch(i){y("admin_role_save",j(i,"Failed to save role"))}}async function ts(s){s.preventDefault();const t=String(k.permType||"").toUpperCase().trim(),i=String(k.permKey||"").toUpperCase().trim(),r=String(k.rolesCsv||"").trim(),g=!!k.enabled;if(!(!t||!i)){if(t!=="ACTION"&&t!=="UI"){x.error("permType must be ACTION or UI");return}try{await ce(n,[{permType:t,permKey:i,rolesCsv:r,enabled:g}]),x.success("Permission saved"),L({permType:"UI",permKey:"",rolesCsv:"",enabled:!0}),await w()}catch(o){y("admin_permission_save",j(o,"Failed to save permission"))}}}async function as(s){if(s.preventDefault(),!(!b.jobRole||!b.jobTitle))try{await Is(n,b),x.success("Template saved"),S({templateId:null,jobRole:"",jobTitle:"",jd:"",responsibilities:"",skills:"",shift:"",payScale:"",perks:"",notes:"",active:!0}),await te()}catch(t){y("admin_template_save",j(t,"Failed to save template"))}}async function ls(s){s.preventDefault();const t=Number(xe),i=Number(je);if(!Number.isFinite(t)||t<0||t>10){x.error("Passing marks must be 0–10");return}if(!Number.isFinite(i)||i<0||i>10){x.error("NotPick threshold must be 0–10");return}try{await ws(n,[{key:"PASSING_MARKS",value:t,type:"number",scope:"GLOBAL"},{key:"NOT_PICK_THRESHOLD",value:i,type:"number",scope:"GLOBAL"},{key:"INTERVIEW_MESSAGE_TEMPLATE",value:String(ve||""),type:"string",scope:"GLOBAL"}]),x.success("Settings saved"),await ae()}catch(r){y("admin_settings_save",j(r,"Failed to save settings"))}}async function is(){ge(!0);try{const s=await ks(n);x.success(`Final Hold no-show auto reject done (rejected: ${s.rejected??0})`)}catch(s){y("admin_final_noshow",j(s,"Failed to run Final Hold no-show auto reject"))}finally{ge(!1)}}return e.jsxs(bs,{children:[e.jsxs("div",{className:"card",children:[E==="ADMIN"?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},children:[e.jsx("button",{className:"button",type:"button",onClick:()=>c("/dashboard"),children:"Open Dashboard"}),e.jsx("button",{className:"button",type:"button",onClick:()=>c("/hr/review"),children:"Open HR Portal"}),e.jsx("button",{className:"button",type:"button",onClick:()=>c("/owner"),children:"Open Owner Portal"}),e.jsx("button",{className:"button",type:"button",onClick:()=>c("/tests"),children:"Open Tests"})]}):null,e.jsxs("div",{className:"row",children:[e.jsx("h2",{style:{margin:0},children:"Admin"}),e.jsx("div",{className:"spacer"}),e.jsx("button",{className:"button",onClick:()=>c("/dashboard"),children:"Back"})]}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"tabs admin-tabs",children:P.map(s=>{const t=s.icon;return e.jsxs("button",{className:["tab",p===s.key?"active":""].join(" "),onClick:()=>U(s.key),type:"button",children:[e.jsx(t,{size:16}),e.jsx("span",{children:s.label})]},s.key)})})]}),e.jsx("div",{style:{height:12}}),p==="users"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"User Management"}),e.jsx("form",{onSubmit:es,className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Email",value:N.email,onChange:s=>T(t=>({...t,email:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:260}}),e.jsx("input",{placeholder:"Full name",value:N.fullName,onChange:s=>T(t=>({...t,fullName:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:220}}),e.jsx("select",{value:N.role,onChange:s=>T(t=>({...t,role:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:ie.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:N.active,onChange:s=>T(t=>({...t,active:s.target.checked}))}),"Active"]}),e.jsx("button",{className:"button primary",type:"submit",disabled:!N.email||!N.role,children:"Save"}),e.jsx("button",{className:"button",type:"button",onClick:()=>T({email:"",fullName:"",role:"EA",active:!0}),children:"Clear"})]})}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:u?"Loading…":`${W.length} users`}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"Email"}),e.jsx("th",{align:"left",children:"Name"}),e.jsx("th",{align:"left",children:"Role"}),e.jsx("th",{align:"left",children:"Status"}),e.jsx("th",{align:"left",children:"Last Login"}),e.jsx("th",{align:"left",children:"Action"})]})}),e.jsx("tbody",{children:W.map(s=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{children:s.email}),e.jsx("td",{children:s.fullName}),e.jsx("td",{children:s.role}),e.jsx("td",{children:s.status}),e.jsx("td",{className:"small",children:s.lastLoginAt?String(s.lastLoginAt):"-"}),e.jsx("td",{children:e.jsx("button",{className:"button",type:"button",onClick:()=>T({email:s.email,fullName:s.fullName,role:s.role,active:String(s.status).toUpperCase()==="ACTIVE"}),children:"Edit"})})]},s.email))})]})})]}):null,p==="roles"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Roles"}),e.jsx("div",{className:"small",style:{marginBottom:10},children:"Create/update roles. New roles can log in when status is ACTIVE."}),e.jsx("form",{onSubmit:ss,className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"roleCode (e.g., MIS)",value:h.roleCode,onChange:s=>C(t=>({...t,roleCode:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:220}}),e.jsx("input",{placeholder:"roleName (display)",value:h.roleName,onChange:s=>C(t=>({...t,roleName:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:240}}),e.jsxs("select",{value:h.status,onChange:s=>C(t=>({...t,status:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"ACTIVE",children:"ACTIVE"}),e.jsx("option",{value:"INACTIVE",children:"INACTIVE"})]}),e.jsx("button",{className:"button primary",type:"submit",disabled:!h.roleCode,children:"Save"}),e.jsx("button",{className:"button",type:"button",onClick:()=>C({roleCode:"",roleName:"",status:"ACTIVE"}),children:"Clear"}),e.jsx("button",{className:"button",type:"button",onClick:_,disabled:d,children:d?"Loading…":"Refresh"})]})}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:d?"Loading…":`${(I||[]).length} roles`}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"roleCode"}),e.jsx("th",{align:"left",children:"roleName"}),e.jsx("th",{align:"left",children:"status"}),e.jsx("th",{align:"left",children:"updatedAt"}),e.jsx("th",{align:"left",children:"updatedBy"}),e.jsx("th",{align:"left",children:"Action"})]})}),e.jsx("tbody",{children:(I||[]).map(s=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{children:s.roleCode}),e.jsx("td",{children:s.roleName||"-"}),e.jsx("td",{children:s.status}),e.jsx("td",{className:"small",children:s.updatedAt?String(s.updatedAt):"-"}),e.jsx("td",{className:"small",children:_e(s.updatedBy)||"-"}),e.jsx("td",{children:e.jsx("button",{className:"button",type:"button",onClick:()=>C({roleCode:s.roleCode,roleName:s.roleName||"",status:String(s.status||"ACTIVE").toUpperCase()}),children:"Edit"})})]},s.roleCode))})]})})]}):null,p==="trainings"?e.jsx(Us,{token:n}):null,p==="permissions"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Permissions"}),e.jsx("div",{className:"small",style:{marginBottom:10},children:"Manage ACTION/UI permissions (comma-separated roles). UI keys prefixed with PORTAL_ control portal access."}),e.jsxs("div",{className:"card",style:{background:"#fafafa",marginBottom:12},children:[e.jsxs("div",{className:"row",style:{flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("select",{value:R,onChange:s=>We(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"",children:"Quick assign role (optional)"}),ie.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("button",{className:"button",type:"button",disabled:!R||K,onClick:()=>Ye(R),children:"Grant all portals"}),e.jsx("button",{className:"button",type:"button",disabled:!R||K,onClick:()=>Ze(R),children:"Revoke all portals"}),e.jsx("div",{className:"spacer"}),e.jsx("button",{className:"button",type:"button",disabled:K,onClick:Xe,children:"One-click: MIS (Excel only)"})]}),e.jsx("div",{className:"small",style:{marginTop:6,color:"#666"},children:"With a role selected, click the checkbox in the table to grant/revoke that permission for the role (auto-saves)."})]}),e.jsx("form",{onSubmit:ts,className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsxs("select",{value:k.permType,onChange:s=>L(t=>({...t,permType:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"UI",children:"UI"}),e.jsx("option",{value:"ACTION",children:"ACTION"})]}),e.jsx("input",{placeholder:"permKey (e.g., PORTAL_HR_REVIEW)",value:k.permKey,onChange:s=>L(t=>({...t,permKey:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:320}}),e.jsx("input",{placeholder:"rolesCsv (e.g., ADMIN,HR)",value:k.rolesCsv,onChange:s=>L(t=>({...t,rolesCsv:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:320}}),e.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:!!k.enabled,onChange:s=>L(t=>({...t,enabled:s.target.checked}))}),"Enabled"]}),e.jsx("button",{className:"button primary",type:"submit",disabled:!k.permType||!k.permKey,children:"Save"}),e.jsx("button",{className:"button",type:"button",onClick:()=>L({permType:"UI",permKey:"",rolesCsv:"",enabled:!0}),children:"Clear"}),e.jsx("button",{className:"button",type:"button",onClick:w,disabled:D,children:D?"Loading…":"Refresh"})]})}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsxs("select",{value:J,onChange:s=>Ee(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"",children:"All types"}),e.jsx("option",{value:"UI",children:"UI"}),e.jsx("option",{value:"ACTION",children:"ACTION"})]}),e.jsx("input",{placeholder:"Search (optional)",value:q,onChange:s=>Pe(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:260}}),e.jsx("div",{className:"spacer"}),e.jsx("div",{className:"small",children:D?"Loading…":`${Te.length} rules`})]})}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"Type"}),e.jsx("th",{align:"left",children:"Key"}),e.jsx("th",{align:"left",children:"Enabled"}),e.jsx("th",{align:"left",children:"Roles"}),e.jsx("th",{align:"left",children:"updatedAt"}),e.jsx("th",{align:"left",children:"updatedBy"}),e.jsx("th",{align:"left",children:"Action"})]})}),e.jsx("tbody",{children:Te.map(s=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{children:s.permType}),e.jsx("td",{className:"small",children:s.permKey}),e.jsx("td",{children:s.enabled?"TRUE":"FALSE"}),e.jsx("td",{className:"small",children:s.rolesCsv||"-"}),e.jsx("td",{className:"small",children:s.updatedAt?String(s.updatedAt):"-"}),e.jsx("td",{className:"small",children:_e(s.updatedBy)||"-"}),e.jsxs("td",{children:[R?e.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:H(s.rolesCsv,R),disabled:K,onChange:t=>Qe(s,R,t.target.checked)}),"Allow"]}):null,e.jsx("button",{className:"button",type:"button",onClick:()=>L({permType:String(s.permType||"UI").toUpperCase(),permKey:s.permKey,rolesCsv:s.rolesCsv||"",enabled:!!s.enabled}),children:"Edit"})]})]},`${s.permType}:${s.permKey}`))})]})}),e.jsx("div",{style:{height:8}}),e.jsx("div",{className:"small",style:{color:"#666"},children:"Tip: rolesCsv uses role codes (e.g., ADMIN,HR,MIS). To disable a permission for everyone, uncheck Enabled."})]}):null,p==="settings"?e.jsxs("div",{className:"card",style:{marginTop:12},children:[e.jsx("h3",{style:{marginTop:0},children:"Manual Actions"}),e.jsx("div",{className:"small",style:{marginBottom:10},children:"Run system actions manually (admin-only)."}),e.jsx("div",{className:"row",style:{flexWrap:"wrap",gap:10,alignItems:"center"},children:e.jsx("button",{className:"button",type:"button",onClick:is,disabled:G,children:G?"Running…":"Run Final Hold No-show Auto Reject"})})]}):null,p==="templates"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Job Templates"}),e.jsxs("form",{onSubmit:as,className:"card",style:{background:"#fafafa"},children:[e.jsx("div",{className:"small",style:{marginBottom:8},children:"Create/update templates by Job Role (CRM, MIS, Jr Accountant, …)"}),e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Job Role (key)",value:b.jobRole,onChange:s=>S(t=>({...t,jobRole:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:220}}),e.jsx("input",{placeholder:"Job Title",value:b.jobTitle,onChange:s=>S(t=>({...t,jobTitle:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:240}}),e.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:b.active,onChange:s=>S(t=>({...t,active:s.target.checked}))}),"Active"]}),e.jsx("button",{className:"button primary",type:"submit",disabled:!b.jobRole||!b.jobTitle,children:"Save"}),e.jsx("button",{className:"button",type:"button",onClick:()=>S({templateId:null,jobRole:"",jobTitle:"",jd:"",responsibilities:"",skills:"",shift:"",payScale:"",perks:"",notes:"",active:!0}),children:"New"})]}),e.jsx("div",{style:{height:10}}),e.jsx("textarea",{placeholder:"JD",value:b.jd,onChange:s=>S(t=>({...t,jd:s.target.value})),rows:4,style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #d0d5dd"}}),e.jsx("div",{style:{height:8}}),e.jsx("textarea",{placeholder:"Responsibilities",value:b.responsibilities,onChange:s=>S(t=>({...t,responsibilities:s.target.value})),rows:3,style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #d0d5dd"}}),e.jsx("div",{style:{height:8}}),e.jsx("textarea",{placeholder:"Skills",value:b.skills,onChange:s=>S(t=>({...t,skills:s.target.value})),rows:3,style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #d0d5dd"}}),e.jsx("div",{style:{height:8}}),e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Shift",value:b.shift,onChange:s=>S(t=>({...t,shift:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180}}),e.jsx("input",{placeholder:"Pay scale",value:b.payScale,onChange:s=>S(t=>({...t,payScale:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180}}),e.jsx("input",{placeholder:"Perks",value:b.perks,onChange:s=>S(t=>({...t,perks:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180}})]}),e.jsx("div",{style:{height:8}}),e.jsx("textarea",{placeholder:"Notes",value:b.notes,onChange:s=>S(t=>({...t,notes:s.target.value})),rows:2,style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #d0d5dd"}})]}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:Me?"Loading…":`${me.length} templates`}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"Job Role"}),e.jsx("th",{align:"left",children:"Job Title"}),e.jsx("th",{align:"left",children:"Status"}),e.jsx("th",{align:"left",children:"Action"})]})}),e.jsx("tbody",{children:me.map(s=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{children:s.jobRole}),e.jsx("td",{children:s.jobTitle}),e.jsx("td",{children:s.status}),e.jsx("td",{children:e.jsx("button",{className:"button",type:"button",onClick:()=>S({templateId:s.templateId,jobRole:s.jobRole,jobTitle:s.jobTitle,jd:s.jd,responsibilities:s.responsibilities,skills:s.skills,shift:s.shift,payScale:s.payScale,perks:s.perks,notes:s.notes,active:String(s.status).toUpperCase()==="ACTIVE"}),children:"Edit"})})]},s.templateId))})]})})]}):null,p==="settings"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Settings"}),e.jsx("div",{className:"small",children:"Global thresholds (server-enforced later in pipeline)"}),e.jsx("form",{onSubmit:ls,className:"card",style:{marginTop:12,background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["Passing marks (default 6/10)",e.jsx("input",{type:"number",value:xe,onChange:s=>ye(s.target.value),min:0,max:10,step:1,style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",width:180}})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["NotPick threshold (default 3)",e.jsx("input",{type:"number",value:je,onChange:s=>be(s.target.value),min:0,max:10,step:1,style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",width:180}})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:6,minWidth:420,flex:"1 1 420px"},children:["Interview Message Template",e.jsxs("span",{style:{color:"#666"},children:["Use placeholders: ","{{Candidate Name}}",", ","{{Job Title}}",", ","{{Date}}",", ","{{Time}}"]}),e.jsx("textarea",{rows:6,value:ve,onChange:s=>fe(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},placeholder:"Paste the exact message template here"})]}),e.jsx("div",{className:"spacer"}),e.jsx("button",{className:"button primary",type:"submit",disabled:Oe,children:"Save"})]})})]}):null,p==="logs"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Logs Viewer"}),e.jsx("div",{className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["Type",e.jsxs("select",{value:F,onChange:s=>De(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"AUDIT",children:"Audit"}),e.jsx("option",{value:"REJECTION",children:"Rejection"}),e.jsx("option",{value:"HOLD",children:"Hold"}),e.jsx("option",{value:"JOIN",children:"Join"})]})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["From",e.jsx("input",{type:"date",value:B,onChange:s=>Ke(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"}})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["To",e.jsx("input",{type:"date",value:V,onChange:s=>Be(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"}})]}),e.jsx("input",{placeholder:"stageTag (optional)",value:Q,onChange:s=>Ve(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180,marginTop:18}}),e.jsxs("select",{value:X,onChange:s=>$e(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",marginTop:18},children:[e.jsx("option",{value:"",children:"Actor role (any)"}),ie.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"SYSTEM",children:"SYSTEM"})]}),F==="AUDIT"?e.jsxs(e.Fragment,{children:[e.jsx("input",{placeholder:"entityType (AUDIT)",value:Y,onChange:s=>He(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:160,marginTop:18}}),e.jsx("input",{placeholder:"entityId (AUDIT)",value:Z,onChange:s=>ze(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180,marginTop:18}})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{placeholder:"candidateId",value:ee,onChange:s=>Je(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180,marginTop:18}}),e.jsx("input",{placeholder:"requirementId",value:se,onChange:s=>qe(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180,marginTop:18}})]}),e.jsx("button",{className:"button primary",type:"button",onClick:le,disabled:Ne,style:{marginTop:18},children:"Refresh"})]})}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:Ne?"Loading…":`${Se.length} rows (latest first)`}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"At"}),e.jsx("th",{align:"left",children:"stageTag"}),e.jsx("th",{align:"left",children:"actorRole"}),e.jsx("th",{align:"left",children:"actorUserId"}),e.jsx("th",{align:"left",children:"remark"}),e.jsx("th",{align:"left",children:"ref"})]})}),e.jsx("tbody",{children:Se.map((s,t)=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{className:"small",children:s.at?String(s.at):"-"}),e.jsx("td",{className:"small",children:s.stageTag||"-"}),e.jsx("td",{className:"small",children:s.actorRole||"-"}),e.jsx("td",{className:"small",children:s.actorUserId||"-"}),e.jsx("td",{className:"small",children:s.remark||"-"}),e.jsx("td",{className:"small",children:F==="AUDIT"?`${s.entityType||""}:${s.entityId||""}`:`${s.candidateId||""}:${s.requirementId||""}`})]},String(s.logId||t)))})]})})]}):null,p==="system"?e.jsxs("div",{className:"card system-health-section",children:[e.jsxs("div",{className:"row",style:{marginBottom:"1.5rem"},children:[e.jsxs("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:8},children:[e.jsx(oe,{size:20}),"System Health & Monitoring"]}),e.jsx("div",{className:"spacer"}),e.jsxs("span",{className:"badge badge-success",style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(vs,{size:12}),"All Systems Operational"]})]}),e.jsx(fs,{}),e.jsx("div",{style:{height:"1.5rem"}}),e.jsxs("div",{className:"admin-stats-grid",children:[e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("div",{className:"stat-icon blue",children:e.jsx(Ns,{size:24})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("span",{className:"stat-value",children:"PostgreSQL"}),e.jsx("span",{className:"stat-label",children:"Database Status"})]}),e.jsx("span",{className:"stat-status online",children:"Online"})]}),e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("div",{className:"stat-icon green",children:e.jsx(oe,{size:24})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("span",{className:"stat-value",children:"Flask API"}),e.jsx("span",{className:"stat-label",children:"Backend Server"})]}),e.jsx("span",{className:"stat-status online",children:"Running"})]}),e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("div",{className:"stat-icon purple",children:e.jsx(we,{size:24})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("span",{className:"stat-value",children:W.length}),e.jsx("span",{className:"stat-label",children:"Total Users"})]})]}),e.jsxs("div",{className:"admin-stat-card",children:[e.jsx("div",{className:"stat-icon orange",children:e.jsx(Re,{size:24})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("span",{className:"stat-value",children:v.length}),e.jsx("span",{className:"stat-label",children:"Permissions"})]})]})]}),e.jsx("div",{style:{height:"1.5rem"}}),e.jsxs("div",{className:"admin-quick-actions",children:[e.jsx("h4",{style:{marginTop:0,marginBottom:"1rem"},children:"Quick Actions"}),e.jsxs("div",{className:"row",style:{gap:"0.75rem",flexWrap:"wrap"},children:[e.jsxs("button",{className:"button primary",onClick:$,disabled:u,children:[e.jsx(de,{size:16}),"Refresh Users"]}),e.jsxs("button",{className:"button",onClick:_,disabled:d,children:[e.jsx(de,{size:16}),"Refresh Roles"]}),e.jsxs("button",{className:"button",onClick:w,disabled:D,children:[e.jsx(de,{size:16}),"Refresh Permissions"]}),e.jsxs("button",{className:"button warning",onClick:handleFinalNoshow,disabled:G,children:[e.jsx(Cs,{size:16}),"Auto-Reject No-Shows"]})]})]})]}):null]})}export{Ws as AdminPage};
