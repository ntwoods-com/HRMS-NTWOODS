import{r as a,j as e,S as Te,n as y,u as ts,a as as,b as ls,c as is,p as rs,t as ns,s as os,l as ds,A as cs,d as ps,e as ms,f as ke,g as ne,h as us,i as hs,k as gs}from"./index-grL27em3.js";import{t as ys,a as xs}from"./training-CjQMu29P.js";import{s as we}from"./pii-BcFV6mqh.js";function bs(d){return!Array.isArray(d)||!d.length?"":d.filter(Boolean).map(r=>String(r)).join(`
`)}function js({token:d}){const[r,E]=a.useState(!1),[P,m]=a.useState([]),[_,W]=a.useState(!1);function O(l){const p=(Array.isArray(l)?l:[]).map(h=>String(h||"").trim()).filter(Boolean);return p.length?p:[""]}const[u,v]=a.useState({training_id:"",name:"",department:"",description:"",video_links:[""],documentsLines:""});async function f(){E(!0);try{const l=await ys(d);m(l.items??[])}catch(l){y.error((l==null?void 0:l.message)||"Failed to load trainings")}finally{E(!1)}}a.useEffect(()=>{f()},[]);const T=a.useMemo(()=>!!String(u.name||"").trim()&&!!String(u.department||"").trim(),[u]);async function w(l){var c;if((c=l==null?void 0:l.preventDefault)==null||c.call(l),!T){y.error("Name and Department are required");return}W(!0);try{const p=O(u.video_links).filter(Boolean),h={training_id:String(u.training_id||"").trim()||void 0,name:String(u.name||"").trim(),department:String(u.department||"").trim(),description:String(u.description||"").trim(),video_links:p,documentsLines:String(u.documentsLines||"")},C=await xs(d,h);y.success(h.training_id?"Training updated":"Training created"),v({training_id:"",name:"",department:"",description:"",video_links:[""],documentsLines:""}),await f(),C!=null&&C.training_id}catch(p){y.error((p==null?void 0:p.message)||"Save failed")}finally{W(!1)}}return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:0},children:"Training Builder (Templates)"}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsxs("button",{className:"button",type:"button",onClick:f,disabled:r,children:[r?e.jsx(Te,{size:14}):null,"Refresh"]})})]}),e.jsx("div",{style:{height:10}}),e.jsxs("form",{onSubmit:w,className:"card",style:{background:"#fafafa"},children:[e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Training Name (e.g., CRM)",value:u.name,onChange:l=>v(c=>({...c,name:l.target.value})),style:{minWidth:220}}),e.jsx("input",{placeholder:"Department (e.g., Accounts)",value:u.department,onChange:l=>v(c=>({...c,department:l.target.value})),style:{minWidth:180}})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{children:[e.jsx("label",{className:"small",style:{fontWeight:700,display:"block",marginBottom:4},children:"Video URLs"}),e.jsx("div",{style:{display:"grid",gap:8},children:(u.video_links||[]).map((l,c)=>e.jsxs("div",{className:"row",style:{gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{placeholder:`Video URL ${c+1}`,value:l,onChange:p=>v(h=>({...h,video_links:(h.video_links||[]).map((C,N)=>N===c?p.target.value:C)})),style:{minWidth:240,flex:1}}),e.jsx("button",{className:"button",type:"button",disabled:_,onClick:()=>v(p=>({...p,video_links:[...p.video_links||[],""]})),children:"+ Add"}),e.jsx("button",{className:"button danger",type:"button",disabled:_||(u.video_links||[]).length<=1,onClick:()=>v(p=>{const h=(p.video_links||[]).filter((C,N)=>N!==c);return{...p,video_links:h.length?h:[""]}}),children:"Remove"})]},c))})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{children:[e.jsx("label",{className:"small",style:{fontWeight:700,display:"block",marginBottom:4},children:"Description"}),e.jsx("textarea",{value:u.description,onChange:l=>v(c=>({...c,description:l.target.value})),rows:3,style:{width:"100%"}})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{children:[e.jsx("label",{className:"small",style:{fontWeight:700,display:"block",marginBottom:4},children:"Documents (one URL or Drive fileId per line)"}),e.jsx("textarea",{value:u.documentsLines,onChange:l=>v(c=>({...c,documentsLines:l.target.value})),rows:3,style:{width:"100%"}})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{className:"button primary",type:"submit",disabled:_||!T,children:[_?e.jsx(Te,{size:14}):null,u.training_id?"Update Template":"Create Template"]}),e.jsx("button",{className:"button",type:"button",onClick:()=>v({training_id:"",name:"",department:"",description:"",video_links:[""],documentsLines:""}),disabled:_,children:"Clear"})]})]}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:r?"Loading…":`${P.length} templates`}),e.jsx("div",{style:{height:10}}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:P.map(l=>e.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:[e.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:220},children:[e.jsx("div",{style:{fontWeight:700},children:l.name}),e.jsx("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:l.department})]}),e.jsx("button",{className:"button",type:"button",onClick:()=>v({training_id:l.training_id,name:l.name||"",department:l.department||"",description:l.description||"",video_links:O(l.video_links||(l.video_link?[l.video_link]:[])),documentsLines:bs(l.documents)}),children:"Edit"})]}),Array.isArray(l.video_links)&&l.video_links.length?e.jsx("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:l.video_links.map((c,p)=>e.jsxs("button",{className:"button",type:"button",onClick:()=>window.open(c,"_blank","noopener,noreferrer"),children:["Open Video ",p+1]},c||p))}):l.video_link?e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"button",type:"button",onClick:()=>window.open(l.video_link,"_blank","noopener,noreferrer"),children:"Open Video"})}):null]},l.training_id))})]})}function x(d,r){y.error(r,{id:d})}function b(d,r){return d instanceof ps?d.message||r:(d==null?void 0:d.message)??r}function Ie(d){if(!d)return"";const r=new Date(d),E=r.getFullYear(),P=String(r.getMonth()+1).padStart(2,"0"),m=String(r.getDate()).padStart(2,"0");return`${E}-${P}-${m}`}function Ns(){const d=ts(),{token:r,role:E}=as(),P=a.useMemo(()=>[{key:"users",label:"Users"},{key:"roles",label:"Roles"},{key:"permissions",label:"Permissions"},{key:"templates",label:"Job Templates"},{key:"trainings",label:"Trainings"},{key:"settings",label:"Settings"},{key:"logs",label:"Logs"}],[]),[m,_]=a.useState("users"),[W,O]=a.useState([]),[u,v]=a.useState(!1),[f,T]=a.useState({email:"",fullName:"",role:"EA",active:!0}),[w,l]=a.useState([]),[c,p]=a.useState(!1),[h,C]=a.useState({roleCode:"",roleName:"",status:"ACTIVE"}),[N,Re]=a.useState([]),[H,oe]=a.useState(!1),[J,Ae]=a.useState(""),[G,_e]=a.useState(""),[k,U]=a.useState({permType:"UI",permKey:"",rolesCsv:"",enabled:!0}),[I,Ue]=a.useState(""),[D,R]=a.useState(!1),[de,Le]=a.useState([]),[Ee,ce]=a.useState(!1),[j,S]=a.useState({templateId:null,jobRole:"",jobTitle:"",jd:"",responsibilities:"",skills:"",shift:"",payScale:"",perks:"",notes:"",active:!0}),[Pe,pe]=a.useState(!1),[me,ue]=a.useState(!1),[he,ge]=a.useState(6),[ye,xe]=a.useState(3),[be,je]=a.useState(""),[ve,fe]=a.useState(!1),[M,We]=a.useState("AUDIT"),[K,Me]=a.useState(Ie(new Date(Date.now()-7*24*60*60*1e3))),[B,Fe]=a.useState(Ie(new Date)),[q,Oe]=a.useState(""),[Q,De]=a.useState(""),[z,Ke]=a.useState(""),[X,Be]=a.useState(""),[Y,Ve]=a.useState(""),[Z,$e]=a.useState(""),[Ce,He]=a.useState([]),ee=a.useCallback(async()=>{v(!0);try{const s=await ls(r,{page:1,pageSize:500});O(s.items??[])}catch(s){x("admin_users_load",b(s,"Failed to load users"))}finally{v(!1)}},[r]),L=a.useCallback(async()=>{p(!0);try{const s=await is(r,{includeInactive:!0});l(s.items??[])}catch(s){x("admin_roles_load",b(s,"Failed to load roles"))}finally{p(!1)}},[r]),A=a.useCallback(async()=>{oe(!0);try{const s=await rs(r);Re(s.items??[])}catch(s){x("admin_permissions_load",b(s,"Failed to load permissions"))}finally{oe(!1)}},[r]),se=a.useCallback(async()=>{ce(!0);try{const s=await ns(r,{page:1,pageSize:500});Le(s.items??[])}catch(s){x("admin_templates_load",b(s,"Failed to load templates"))}finally{ce(!1)}},[r]),te=a.useCallback(async()=>{pe(!0);try{const t=(await os(r)).items??[],i=t.find(o=>o.key==="PASSING_MARKS"),n=t.find(o=>o.key==="NOT_PICK_THRESHOLD"),g=t.find(o=>o.key==="INTERVIEW_MESSAGE_TEMPLATE");i&&ge(Number(i.value??6)),n&&xe(Number(n.value??3)),g&&je(String(g.value??""))}catch(s){x("admin_settings_load",b(s,"Failed to load settings"))}finally{pe(!1)}},[r]),ae=a.useCallback(async()=>{fe(!0);try{const s=await ds(r,{logType:M,from:K?new Date(K).toISOString():null,to:B?new Date(B+"T23:59:59").toISOString():null,stageTag:q||null,actorRole:Q||null,entityType:z||null,entityId:X||null,candidateId:Y||null,requirementId:Z||null,page:1,pageSize:200});He(s.items??[])}catch(s){x("admin_logs_load",b(s,"Failed to load logs"))}finally{fe(!1)}},[r,M,K,B,q,Q,z,X,Y,Z]);a.useEffect(()=>{m==="users"&&ee(),m==="users"&&L(),m==="roles"&&L(),m==="permissions"&&(L(),A()),m==="templates"&&se(),m==="settings"&&te(),m==="logs"&&ae()},[m,ee,L,A,se,te,ae]);const le=a.useMemo(()=>{const i=(Array.isArray(w)?w:[]).filter(n=>String(n.status||"").toUpperCase()==="ACTIVE").map(n=>String(n.roleCode||"").toUpperCase()).filter(Boolean);return i.length?i.sort():["ADMIN","EA","HR","OWNER"]},[w]);a.useMemo(()=>{const s={};for(const t of w||[])s[String(t.roleCode||"").toUpperCase()]=t;return s},[w]);const Ne=a.useMemo(()=>{const s=Array.isArray(N)?N:[],t=String(J||"").toUpperCase().trim(),i=String(G||"").toUpperCase().trim();return s.filter(n=>!(t&&String(n.permType||"").toUpperCase()!==t||i&&!`${n.permType||""}:${n.permKey||""}:${n.rolesCsv||""}`.toUpperCase().includes(i)))},[N,J,G]);function ie(s){return String(s||"").split(",").map(t=>t.trim().toUpperCase()).filter(Boolean)}function Se(s){const t=Array.from(new Set((s||[]).map(i=>String(i||"").trim().toUpperCase()).filter(Boolean)));return t.sort(),t.join(",")}function V(s,t){return t?ie(s).includes(String(t).toUpperCase()):!1}function F(s,t){const i=ie(s);return i.push(String(t).toUpperCase()),Se(i)}function re(s,t){const i=String(t||"").toUpperCase(),n=ie(s).filter(g=>g!==i);return Se(n)}async function $(s){const t=Array.isArray(s)?s:[],i=200;for(let n=0;n<t.length;n+=i)await ne(r,t.slice(n,n+i))}async function Je(s,t,i){const n=String(t||"").toUpperCase().trim();if(n){R(!0);try{const g=i?F(s.rolesCsv,n):re(s.rolesCsv,n);await ne(r,[{permType:String(s.permType||"").toUpperCase(),permKey:String(s.permKey||"").toUpperCase(),rolesCsv:g,enabled:!!s.enabled}]),await A()}catch(g){x("admin_perm_quick_toggle",b(g,"Failed to update permission"))}finally{R(!1)}}}async function Ge(){R(!0);try{await ke(r,{roleCode:"MIS",roleName:"MIS",status:"ACTIVE"}),await L();const s=Array.isArray(N)?N:[],t=[];for(const i of s)V(i.rolesCsv,"MIS")&&t.push({permType:String(i.permType||"").toUpperCase(),permKey:String(i.permKey||"").toUpperCase(),rolesCsv:re(i.rolesCsv,"MIS"),enabled:!!i.enabled});t.length&&await $(t),await $([{permType:"UI",permKey:"PORTAL_TESTS",rolesCsv:F("","MIS"),enabled:!0},{permType:"ACTION",permKey:"TESTS_QUEUE_LIST",rolesCsv:F("","MIS"),enabled:!0},{permType:"ACTION",permKey:"CANDIDATE_TEST_SUBMIT",rolesCsv:F("","MIS"),enabled:!0}]),await A(),y.success("MIS preset applied (Excel only)")}catch(s){x("admin_perm_preset_mis",b(s,"Failed to apply MIS preset"))}finally{R(!1)}}async function qe(s){const t=String(s||"").toUpperCase().trim();if(t){R(!0);try{const g=(Array.isArray(N)?N:[]).filter(o=>String(o.permType||"").toUpperCase()==="UI"&&String(o.permKey||"").toUpperCase().startsWith("PORTAL_")).filter(o=>!V(o.rolesCsv,t)).map(o=>({permType:"UI",permKey:String(o.permKey||"").toUpperCase(),rolesCsv:F(o.rolesCsv,t),enabled:!!o.enabled}));g.length&&await $(g),await A(),y.success("Portals granted")}catch(i){x("admin_perm_grant_portals",b(i,"Failed to grant portals"))}finally{R(!1)}}}async function Qe(s){const t=String(s||"").toUpperCase().trim();if(t){R(!0);try{const g=(Array.isArray(N)?N:[]).filter(o=>String(o.permType||"").toUpperCase()==="UI"&&String(o.permKey||"").toUpperCase().startsWith("PORTAL_")).filter(o=>V(o.rolesCsv,t)).map(o=>({permType:"UI",permKey:String(o.permKey||"").toUpperCase(),rolesCsv:re(o.rolesCsv,t),enabled:!!o.enabled}));g.length&&await $(g),await A(),y.success("Portals revoked")}catch(i){x("admin_perm_revoke_portals",b(i,"Failed to revoke portals"))}finally{R(!1)}}}async function ze(s){if(s.preventDefault(),!(!f.email||!f.role))try{await ms(r,f),y.success("User saved"),T({email:"",fullName:"",role:"EA",active:!0}),await ee()}catch(t){x("admin_user_save",b(t,"Failed to save user"))}}async function Xe(s){s.preventDefault();const t=String(h.roleCode||"").toUpperCase().trim();if(t)try{await ke(r,{roleCode:t,roleName:String(h.roleName||"").trim()||t,status:String(h.status||"ACTIVE").toUpperCase().trim()}),y.success("Role saved"),C({roleCode:"",roleName:"",status:"ACTIVE"}),await L()}catch(i){x("admin_role_save",b(i,"Failed to save role"))}}async function Ye(s){s.preventDefault();const t=String(k.permType||"").toUpperCase().trim(),i=String(k.permKey||"").toUpperCase().trim(),n=String(k.rolesCsv||"").trim(),g=!!k.enabled;if(!(!t||!i)){if(t!=="ACTION"&&t!=="UI"){y.error("permType must be ACTION or UI");return}try{await ne(r,[{permType:t,permKey:i,rolesCsv:n,enabled:g}]),y.success("Permission saved"),U({permType:"UI",permKey:"",rolesCsv:"",enabled:!0}),await A()}catch(o){x("admin_permission_save",b(o,"Failed to save permission"))}}}async function Ze(s){if(s.preventDefault(),!(!j.jobRole||!j.jobTitle))try{await hs(r,j),y.success("Template saved"),S({templateId:null,jobRole:"",jobTitle:"",jd:"",responsibilities:"",skills:"",shift:"",payScale:"",perks:"",notes:"",active:!0}),await se()}catch(t){x("admin_template_save",b(t,"Failed to save template"))}}async function es(s){s.preventDefault();const t=Number(he),i=Number(ye);if(!Number.isFinite(t)||t<0||t>10){y.error("Passing marks must be 0–10");return}if(!Number.isFinite(i)||i<0||i>10){y.error("NotPick threshold must be 0–10");return}try{await gs(r,[{key:"PASSING_MARKS",value:t,type:"number",scope:"GLOBAL"},{key:"NOT_PICK_THRESHOLD",value:i,type:"number",scope:"GLOBAL"},{key:"INTERVIEW_MESSAGE_TEMPLATE",value:String(be||""),type:"string",scope:"GLOBAL"}]),y.success("Settings saved"),await te()}catch(n){x("admin_settings_save",b(n,"Failed to save settings"))}}async function ss(){ue(!0);try{const s=await us(r);y.success(`Final Hold no-show auto reject done (rejected: ${s.rejected??0})`)}catch(s){x("admin_final_noshow",b(s,"Failed to run Final Hold no-show auto reject"))}finally{ue(!1)}}return e.jsxs(cs,{children:[e.jsxs("div",{className:"card",children:[E==="ADMIN"?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},children:[e.jsx("button",{className:"button",type:"button",onClick:()=>d("/dashboard"),children:"Open Dashboard"}),e.jsx("button",{className:"button",type:"button",onClick:()=>d("/hr/review"),children:"Open HR Portal"}),e.jsx("button",{className:"button",type:"button",onClick:()=>d("/owner"),children:"Open Owner Portal"}),e.jsx("button",{className:"button",type:"button",onClick:()=>d("/tests"),children:"Open Tests"})]}):null,e.jsxs("div",{className:"row",children:[e.jsx("h2",{style:{margin:0},children:"Admin"}),e.jsx("div",{className:"spacer"}),e.jsx("button",{className:"button",onClick:()=>d("/dashboard"),children:"Back"})]}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"tabs",children:P.map(s=>e.jsx("button",{className:["tab",m===s.key?"active":""].join(" "),onClick:()=>_(s.key),type:"button",children:s.label},s.key))})]}),e.jsx("div",{style:{height:12}}),m==="users"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"User Management"}),e.jsx("form",{onSubmit:ze,className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Email",value:f.email,onChange:s=>T(t=>({...t,email:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:260}}),e.jsx("input",{placeholder:"Full name",value:f.fullName,onChange:s=>T(t=>({...t,fullName:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:220}}),e.jsx("select",{value:f.role,onChange:s=>T(t=>({...t,role:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:le.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:f.active,onChange:s=>T(t=>({...t,active:s.target.checked}))}),"Active"]}),e.jsx("button",{className:"button primary",type:"submit",disabled:!f.email||!f.role,children:"Save"}),e.jsx("button",{className:"button",type:"button",onClick:()=>T({email:"",fullName:"",role:"EA",active:!0}),children:"Clear"})]})}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:u?"Loading…":`${W.length} users`}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"Email"}),e.jsx("th",{align:"left",children:"Name"}),e.jsx("th",{align:"left",children:"Role"}),e.jsx("th",{align:"left",children:"Status"}),e.jsx("th",{align:"left",children:"Last Login"}),e.jsx("th",{align:"left",children:"Action"})]})}),e.jsx("tbody",{children:W.map(s=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{children:s.email}),e.jsx("td",{children:s.fullName}),e.jsx("td",{children:s.role}),e.jsx("td",{children:s.status}),e.jsx("td",{className:"small",children:s.lastLoginAt?String(s.lastLoginAt):"-"}),e.jsx("td",{children:e.jsx("button",{className:"button",type:"button",onClick:()=>T({email:s.email,fullName:s.fullName,role:s.role,active:String(s.status).toUpperCase()==="ACTIVE"}),children:"Edit"})})]},s.email))})]})})]}):null,m==="roles"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Roles"}),e.jsx("div",{className:"small",style:{marginBottom:10},children:"Create/update roles. New roles can log in when status is ACTIVE."}),e.jsx("form",{onSubmit:Xe,className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"roleCode (e.g., MIS)",value:h.roleCode,onChange:s=>C(t=>({...t,roleCode:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:220}}),e.jsx("input",{placeholder:"roleName (display)",value:h.roleName,onChange:s=>C(t=>({...t,roleName:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:240}}),e.jsxs("select",{value:h.status,onChange:s=>C(t=>({...t,status:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"ACTIVE",children:"ACTIVE"}),e.jsx("option",{value:"INACTIVE",children:"INACTIVE"})]}),e.jsx("button",{className:"button primary",type:"submit",disabled:!h.roleCode,children:"Save"}),e.jsx("button",{className:"button",type:"button",onClick:()=>C({roleCode:"",roleName:"",status:"ACTIVE"}),children:"Clear"}),e.jsx("button",{className:"button",type:"button",onClick:L,disabled:c,children:c?"Loading…":"Refresh"})]})}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:c?"Loading…":`${(w||[]).length} roles`}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"roleCode"}),e.jsx("th",{align:"left",children:"roleName"}),e.jsx("th",{align:"left",children:"status"}),e.jsx("th",{align:"left",children:"updatedAt"}),e.jsx("th",{align:"left",children:"updatedBy"}),e.jsx("th",{align:"left",children:"Action"})]})}),e.jsx("tbody",{children:(w||[]).map(s=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{children:s.roleCode}),e.jsx("td",{children:s.roleName||"-"}),e.jsx("td",{children:s.status}),e.jsx("td",{className:"small",children:s.updatedAt?String(s.updatedAt):"-"}),e.jsx("td",{className:"small",children:we(s.updatedBy)||"-"}),e.jsx("td",{children:e.jsx("button",{className:"button",type:"button",onClick:()=>C({roleCode:s.roleCode,roleName:s.roleName||"",status:String(s.status||"ACTIVE").toUpperCase()}),children:"Edit"})})]},s.roleCode))})]})})]}):null,m==="trainings"?e.jsx(js,{token:r}):null,m==="permissions"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Permissions"}),e.jsx("div",{className:"small",style:{marginBottom:10},children:"Manage ACTION/UI permissions (comma-separated roles). UI keys prefixed with PORTAL_ control portal access."}),e.jsxs("div",{className:"card",style:{background:"#fafafa",marginBottom:12},children:[e.jsxs("div",{className:"row",style:{flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("select",{value:I,onChange:s=>Ue(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"",children:"Quick assign role (optional)"}),le.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("button",{className:"button",type:"button",disabled:!I||D,onClick:()=>qe(I),children:"Grant all portals"}),e.jsx("button",{className:"button",type:"button",disabled:!I||D,onClick:()=>Qe(I),children:"Revoke all portals"}),e.jsx("div",{className:"spacer"}),e.jsx("button",{className:"button",type:"button",disabled:D,onClick:Ge,children:"One-click: MIS (Excel only)"})]}),e.jsx("div",{className:"small",style:{marginTop:6,color:"#666"},children:"With a role selected, click the checkbox in the table to grant/revoke that permission for the role (auto-saves)."})]}),e.jsx("form",{onSubmit:Ye,className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsxs("select",{value:k.permType,onChange:s=>U(t=>({...t,permType:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"UI",children:"UI"}),e.jsx("option",{value:"ACTION",children:"ACTION"})]}),e.jsx("input",{placeholder:"permKey (e.g., PORTAL_HR_REVIEW)",value:k.permKey,onChange:s=>U(t=>({...t,permKey:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:320}}),e.jsx("input",{placeholder:"rolesCsv (e.g., ADMIN,HR)",value:k.rolesCsv,onChange:s=>U(t=>({...t,rolesCsv:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:320}}),e.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:!!k.enabled,onChange:s=>U(t=>({...t,enabled:s.target.checked}))}),"Enabled"]}),e.jsx("button",{className:"button primary",type:"submit",disabled:!k.permType||!k.permKey,children:"Save"}),e.jsx("button",{className:"button",type:"button",onClick:()=>U({permType:"UI",permKey:"",rolesCsv:"",enabled:!0}),children:"Clear"}),e.jsx("button",{className:"button",type:"button",onClick:A,disabled:H,children:H?"Loading…":"Refresh"})]})}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsxs("select",{value:J,onChange:s=>Ae(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"",children:"All types"}),e.jsx("option",{value:"UI",children:"UI"}),e.jsx("option",{value:"ACTION",children:"ACTION"})]}),e.jsx("input",{placeholder:"Search (optional)",value:G,onChange:s=>_e(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:260}}),e.jsx("div",{className:"spacer"}),e.jsx("div",{className:"small",children:H?"Loading…":`${Ne.length} rules`})]})}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"Type"}),e.jsx("th",{align:"left",children:"Key"}),e.jsx("th",{align:"left",children:"Enabled"}),e.jsx("th",{align:"left",children:"Roles"}),e.jsx("th",{align:"left",children:"updatedAt"}),e.jsx("th",{align:"left",children:"updatedBy"}),e.jsx("th",{align:"left",children:"Action"})]})}),e.jsx("tbody",{children:Ne.map(s=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{children:s.permType}),e.jsx("td",{className:"small",children:s.permKey}),e.jsx("td",{children:s.enabled?"TRUE":"FALSE"}),e.jsx("td",{className:"small",children:s.rolesCsv||"-"}),e.jsx("td",{className:"small",children:s.updatedAt?String(s.updatedAt):"-"}),e.jsx("td",{className:"small",children:we(s.updatedBy)||"-"}),e.jsxs("td",{children:[I?e.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:V(s.rolesCsv,I),disabled:D,onChange:t=>Je(s,I,t.target.checked)}),"Allow"]}):null,e.jsx("button",{className:"button",type:"button",onClick:()=>U({permType:String(s.permType||"UI").toUpperCase(),permKey:s.permKey,rolesCsv:s.rolesCsv||"",enabled:!!s.enabled}),children:"Edit"})]})]},`${s.permType}:${s.permKey}`))})]})}),e.jsx("div",{style:{height:8}}),e.jsx("div",{className:"small",style:{color:"#666"},children:"Tip: rolesCsv uses role codes (e.g., ADMIN,HR,MIS). To disable a permission for everyone, uncheck Enabled."})]}):null,m==="settings"?e.jsxs("div",{className:"card",style:{marginTop:12},children:[e.jsx("h3",{style:{marginTop:0},children:"Manual Actions"}),e.jsx("div",{className:"small",style:{marginBottom:10},children:"Run system actions manually (admin-only)."}),e.jsx("div",{className:"row",style:{flexWrap:"wrap",gap:10,alignItems:"center"},children:e.jsx("button",{className:"button",type:"button",onClick:ss,disabled:me,children:me?"Running…":"Run Final Hold No-show Auto Reject"})})]}):null,m==="templates"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Job Templates"}),e.jsxs("form",{onSubmit:Ze,className:"card",style:{background:"#fafafa"},children:[e.jsx("div",{className:"small",style:{marginBottom:8},children:"Create/update templates by Job Role (CRM, MIS, Jr Accountant, …)"}),e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Job Role (key)",value:j.jobRole,onChange:s=>S(t=>({...t,jobRole:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:220}}),e.jsx("input",{placeholder:"Job Title",value:j.jobTitle,onChange:s=>S(t=>({...t,jobTitle:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:240}}),e.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:j.active,onChange:s=>S(t=>({...t,active:s.target.checked}))}),"Active"]}),e.jsx("button",{className:"button primary",type:"submit",disabled:!j.jobRole||!j.jobTitle,children:"Save"}),e.jsx("button",{className:"button",type:"button",onClick:()=>S({templateId:null,jobRole:"",jobTitle:"",jd:"",responsibilities:"",skills:"",shift:"",payScale:"",perks:"",notes:"",active:!0}),children:"New"})]}),e.jsx("div",{style:{height:10}}),e.jsx("textarea",{placeholder:"JD",value:j.jd,onChange:s=>S(t=>({...t,jd:s.target.value})),rows:4,style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #d0d5dd"}}),e.jsx("div",{style:{height:8}}),e.jsx("textarea",{placeholder:"Responsibilities",value:j.responsibilities,onChange:s=>S(t=>({...t,responsibilities:s.target.value})),rows:3,style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #d0d5dd"}}),e.jsx("div",{style:{height:8}}),e.jsx("textarea",{placeholder:"Skills",value:j.skills,onChange:s=>S(t=>({...t,skills:s.target.value})),rows:3,style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #d0d5dd"}}),e.jsx("div",{style:{height:8}}),e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Shift",value:j.shift,onChange:s=>S(t=>({...t,shift:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180}}),e.jsx("input",{placeholder:"Pay scale",value:j.payScale,onChange:s=>S(t=>({...t,payScale:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180}}),e.jsx("input",{placeholder:"Perks",value:j.perks,onChange:s=>S(t=>({...t,perks:s.target.value})),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180}})]}),e.jsx("div",{style:{height:8}}),e.jsx("textarea",{placeholder:"Notes",value:j.notes,onChange:s=>S(t=>({...t,notes:s.target.value})),rows:2,style:{width:"100%",padding:8,borderRadius:8,border:"1px solid #d0d5dd"}})]}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:Ee?"Loading…":`${de.length} templates`}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"Job Role"}),e.jsx("th",{align:"left",children:"Job Title"}),e.jsx("th",{align:"left",children:"Status"}),e.jsx("th",{align:"left",children:"Action"})]})}),e.jsx("tbody",{children:de.map(s=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{children:s.jobRole}),e.jsx("td",{children:s.jobTitle}),e.jsx("td",{children:s.status}),e.jsx("td",{children:e.jsx("button",{className:"button",type:"button",onClick:()=>S({templateId:s.templateId,jobRole:s.jobRole,jobTitle:s.jobTitle,jd:s.jd,responsibilities:s.responsibilities,skills:s.skills,shift:s.shift,payScale:s.payScale,perks:s.perks,notes:s.notes,active:String(s.status).toUpperCase()==="ACTIVE"}),children:"Edit"})})]},s.templateId))})]})})]}):null,m==="settings"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Settings"}),e.jsx("div",{className:"small",children:"Global thresholds (server-enforced later in pipeline)"}),e.jsx("form",{onSubmit:es,className:"card",style:{marginTop:12,background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["Passing marks (default 6/10)",e.jsx("input",{type:"number",value:he,onChange:s=>ge(s.target.value),min:0,max:10,step:1,style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",width:180}})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["NotPick threshold (default 3)",e.jsx("input",{type:"number",value:ye,onChange:s=>xe(s.target.value),min:0,max:10,step:1,style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",width:180}})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:6,minWidth:420,flex:"1 1 420px"},children:["Interview Message Template",e.jsxs("span",{style:{color:"#666"},children:["Use placeholders: ","{{Candidate Name}}",", ","{{Job Title}}",", ","{{Date}}",", ","{{Time}}"]}),e.jsx("textarea",{rows:6,value:be,onChange:s=>je(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},placeholder:"Paste the exact message template here"})]}),e.jsx("div",{className:"spacer"}),e.jsx("button",{className:"button primary",type:"submit",disabled:Pe,children:"Save"})]})})]}):null,m==="logs"?e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:"Logs Viewer"}),e.jsx("div",{className:"card",style:{background:"#fafafa"},children:e.jsxs("div",{className:"row",style:{flexWrap:"wrap"},children:[e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["Type",e.jsxs("select",{value:M,onChange:s=>We(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"},children:[e.jsx("option",{value:"AUDIT",children:"Audit"}),e.jsx("option",{value:"REJECTION",children:"Rejection"}),e.jsx("option",{value:"HOLD",children:"Hold"}),e.jsx("option",{value:"JOIN",children:"Join"})]})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["From",e.jsx("input",{type:"date",value:K,onChange:s=>Me(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"}})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:6},children:["To",e.jsx("input",{type:"date",value:B,onChange:s=>Fe(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd"}})]}),e.jsx("input",{placeholder:"stageTag (optional)",value:q,onChange:s=>Oe(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180,marginTop:18}}),e.jsxs("select",{value:Q,onChange:s=>De(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",marginTop:18},children:[e.jsx("option",{value:"",children:"Actor role (any)"}),le.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"SYSTEM",children:"SYSTEM"})]}),M==="AUDIT"?e.jsxs(e.Fragment,{children:[e.jsx("input",{placeholder:"entityType (AUDIT)",value:z,onChange:s=>Ke(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:160,marginTop:18}}),e.jsx("input",{placeholder:"entityId (AUDIT)",value:X,onChange:s=>Be(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180,marginTop:18}})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{placeholder:"candidateId",value:Y,onChange:s=>Ve(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180,marginTop:18}}),e.jsx("input",{placeholder:"requirementId",value:Z,onChange:s=>$e(s.target.value),style:{padding:8,borderRadius:8,border:"1px solid #d0d5dd",minWidth:180,marginTop:18}})]}),e.jsx("button",{className:"button primary",type:"button",onClick:ae,disabled:ve,style:{marginTop:18},children:"Refresh"})]})}),e.jsx("div",{style:{height:12}}),e.jsx("div",{className:"small",children:ve?"Loading…":`${Ce.length} rows (latest first)`}),e.jsx("div",{style:{overflowX:"auto",marginTop:8},children:e.jsxs("table",{width:"100%",cellPadding:"8",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#fafafa"},children:[e.jsx("th",{align:"left",children:"At"}),e.jsx("th",{align:"left",children:"stageTag"}),e.jsx("th",{align:"left",children:"actorRole"}),e.jsx("th",{align:"left",children:"actorUserId"}),e.jsx("th",{align:"left",children:"remark"}),e.jsx("th",{align:"left",children:"ref"})]})}),e.jsx("tbody",{children:Ce.map((s,t)=>e.jsxs("tr",{style:{borderTop:"1px solid #eee"},children:[e.jsx("td",{className:"small",children:s.at?String(s.at):"-"}),e.jsx("td",{className:"small",children:s.stageTag||"-"}),e.jsx("td",{className:"small",children:s.actorRole||"-"}),e.jsx("td",{className:"small",children:s.actorUserId||"-"}),e.jsx("td",{className:"small",children:s.remark||"-"}),e.jsx("td",{className:"small",children:M==="AUDIT"?`${s.entityType||""}:${s.entityId||""}`:`${s.candidateId||""}:${s.requirementId||""}`})]},String(s.logId||t)))})]})})]}):null]})}export{Ns as AdminPage};
