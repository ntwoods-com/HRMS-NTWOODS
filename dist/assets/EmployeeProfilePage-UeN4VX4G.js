import{ap as O,a as L,r as m,j as e,A as C,S as D,n as l,aq as _}from"./index-grL27em3.js";import{u as v,e as E}from"./training-CjQMu29P.js";import{T as w}from"./TrainingList-BS7WbGfL.js";import{o as k}from"./files-CjotXup9.js";import{s as M}from"./pii-BcFV6mqh.js";function g(r){if(!r)return"-";const i=r instanceof Date?r:new Date(r);return Number.isNaN(i.getTime())?String(r):i.toLocaleString()}function B(){const{employeeId:r}=O(),{token:i,role:N,legacyRole:j,canPortal:x,canAction:T}=L();function A(s,a){const n=typeof x=="function"?x(s):null;if(n===!0||n===!1)return n;const o=String(j||N||"").toUpperCase();return Array.isArray(a)?a.includes(o):!1}function f(s,a){const n=typeof T=="function"?T(s):null;if(n===!0||n===!1)return n;const o=String(j||N||"").toUpperCase();return Array.isArray(a)?a.includes(o):!1}const u=A("PORTAL_EMPLOYEE_PROFILE",["EA","HR","OWNER","ADMIN"]),R=u&&f("EMPLOYEE_GET",["EA","HR","OWNER","ADMIN"]),[c,I]=m.useState(!1),[t,b]=m.useState(null),[p,S]=m.useState(!1),[y,d]=m.useState([]);async function h(){if(r&&u&&f("EMPLOYEE_GET",["EA","HR","OWNER","ADMIN"])){I(!0);try{const s=await _(i,{employeeId:r});if(b(s),s!=null&&s.candidateId&&f("TRAINING_LIST",["ADMIN","EA","HR","OWNER"])){S(!0);try{const a=await E(i,{candidateId:s.candidateId});d(a.items??[])}catch{d([])}finally{S(!1)}}else d([])}catch(s){l.error((s==null?void 0:s.message)||"Failed to load"),b(null),d([])}finally{I(!1)}}}m.useEffect(()=>{h()},[r,u]);function P(s){if(!s)return;k(s,i)||l.error("Unable to open file")}return e.jsxs(C,{children:[u?null:e.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[e.jsx("div",{style:{fontWeight:700},children:"Not allowed"}),e.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"You don’t have access to Employee Profile portal."})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:0},children:"Employee Profile"}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{className:"button",type:"button",onClick:h,disabled:c||!R,children:"Refresh"})})]}),e.jsx("div",{style:{height:10}}),e.jsx("div",{className:"small",children:c?"Loading…":r}),e.jsx("div",{style:{height:12}}),!t&&!c?e.jsx("div",{className:"small",children:"Employee not found."}):t?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:[e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:t.employeeName||t.employeeId}),e.jsxs("div",{className:"small",style:{marginTop:4},children:["EmployeeId: ",e.jsx("b",{children:t.employeeId})]}),e.jsxs("div",{className:"small",style:{marginTop:4},children:["RequirementId: ",e.jsx("b",{children:t.requirementId})," ",t.jobTitle?`• ${t.jobTitle}`:""]}),e.jsxs("div",{className:"small",style:{marginTop:4},children:["Role: ",t.jobRole||"-"," • Source: ",t.source||"-"]}),e.jsxs("div",{className:"small",style:{marginTop:4},children:["Joined: ",g(t.joinedAt)]}),e.jsxs("div",{className:"small",style:{marginTop:4},children:["Probation: ",g(t.probationStartAt)," → ",g(t.probationEndsAt)]}),e.jsxs("div",{className:"small",style:{marginTop:4},children:["Created: ",g(t.createdAt)," • By: ",M(t.createdBy)||"-"]}),e.jsx("div",{style:{height:10}}),e.jsx("button",{className:"button",type:"button",onClick:()=>P(t.cvFileId),disabled:!t.cvFileId,children:"View CV"})]}),e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center"},children:[e.jsx("div",{style:{fontWeight:700},children:"Trainings"}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsxs("button",{className:"button",type:"button",onClick:h,disabled:c||p,children:[c||p?e.jsx(D,{size:14}):null,"Refresh"]})})]}),e.jsx("div",{style:{height:10}}),y.length?e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center",marginBottom:10},children:(()=>{const s=y.reduce((a,n)=>{const o=String((n==null?void 0:n.status)||"").toUpperCase();return a.TOTAL+=1,o==="COMPLETED"?a.COMPLETED+=1:o==="IN_PROGRESS"?a.IN_PROGRESS+=1:o==="OVERDUE"?a.OVERDUE+=1:a.PENDING+=1,a},{TOTAL:0,PENDING:0,IN_PROGRESS:0,COMPLETED:0,OVERDUE:0});return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"badge",children:["Total: ",s.TOTAL]}),e.jsxs("span",{className:"badge",style:{background:"#f59e0b",color:"#fff"},children:["Pending: ",s.PENDING]}),e.jsxs("span",{className:"badge",style:{background:"#3b82f6",color:"#fff"},children:["In-Progress: ",s.IN_PROGRESS]}),e.jsxs("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:["Completed: ",s.COMPLETED]}),e.jsxs("span",{className:"badge",style:{background:"#ef4444",color:"#fff"},children:["Overdue: ",s.OVERDUE]}),e.jsx("button",{className:"button",type:"button",onClick:async()=>{const a=[`Employee: ${t.employeeName||t.employeeId}`,`Candidate: ${t.candidateId||""}`,`Training Summary: Total=${s.TOTAL}, Completed=${s.COMPLETED}, Pending=${s.PENDING}, In-Progress=${s.IN_PROGRESS}, Overdue=${s.OVERDUE}`];try{await navigator.clipboard.writeText(a.join(`
`)),l.success("Summary copied")}catch{l.error("Copy failed")}},disabled:p,children:"Copy Summary"})]})})()}):null,e.jsx(w,{items:y,token:i,loading:p,canUpdate:f("TRAINING_STATUS_UPDATE",["ADMIN","HR"]),onStart:async s=>{try{await v(i,{candidate_id:t.candidateId,assigned_id:s.assigned_id,op:"START",remarks:""}),l.success("Marked In-Progress");const a=await E(i,{candidateId:t.candidateId});d(a.items??[])}catch(a){l.error((a==null?void 0:a.message)||"Failed")}},onComplete:async s=>{try{await v(i,{candidate_id:t.candidateId,assigned_id:s.assigned_id,op:"COMPLETE",remarks:""}),l.success("Completed");const a=await E(i,{candidateId:t.candidateId});d(a.items??[])}catch(a){l.error((a==null?void 0:a.message)||"Failed")}}})]}),e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"Journey Timeline"}),Array.isArray(t.timeline)&&t.timeline.length?e.jsx("div",{style:{display:"grid",gap:8},children:t.timeline.map((s,a)=>e.jsxs("div",{className:"card",style:{background:"#fff"},children:[e.jsxs("div",{className:"small",children:[e.jsx("b",{children:g(s.at)})," • ",s.stageTag||s.action||s.source||"-"]}),e.jsxs("div",{className:"small",style:{marginTop:4},children:[s.fromState||s.toState?e.jsxs("span",{children:[s.fromState?String(s.fromState):"",s.fromState||s.toState?" → ":"",s.toState?String(s.toState):""]}):null,s.remark?` • ${s.remark}`:""]}),e.jsxs("div",{className:"small",style:{marginTop:4,opacity:.8},children:[s.actorRole?`${s.actorRole}`:"",s.actorUserId?` (${s.actorUserId})`:""]})]},`${s.at||"at"}:${a}`))}):e.jsx("div",{className:"small",children:"No timeline entries."})]})]}):null]})]})}export{B as EmployeeProfilePage};
