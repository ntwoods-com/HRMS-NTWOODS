import{a as T,r as c,j as e,h as F,S as C,_ as E,aj as _,n as d,ak as W}from"./index-3pZLK3h4.js";import{C as O}from"./Collapsible-_WuiTKIw.js";import{S as U}from"./SlaCountdown-CXXTphw8.js";import{v as $}from"./scheduling-mgpGDE0C.js";import{o as M}from"./files-MBQmrkrP.js";import{c as D}from"./pii-BcFV6mqh.js";import"./useNowTick-CWrjpJwC.js";function B(l){if(!l)return"";const r=l instanceof Date?l:new Date(l);if(Number.isNaN(r.getTime()))return"";const o=f=>String(f).padStart(2,"0"),g=r.getFullYear(),h=o(r.getMonth()+1),x=o(r.getDate()),m=o(r.getHours()),u=o(r.getMinutes());return`${g}-${h}-${x}T${m}:${u}`}function V(l){if(!l)return"";const r=l instanceof Date?l:new Date(l);return Number.isNaN(r.getTime())?String(l):r.toLocaleString()}function Q(){const{token:l,role:r,legacyRole:o,canPortal:g,canAction:h}=T();function x(a,t){const s=typeof g=="function"?g(a):null;if(s===!0||s===!1)return s;const n=String(o||r||"").toUpperCase();return Array.isArray(t)?t.includes(n):!1}function m(a,t){const s=typeof h=="function"?h(a):null;if(s===!0||s===!1)return s;const n=String(o||r||"").toUpperCase();return Array.isArray(t)?t.includes(n):!1}const u=x("PORTAL_HR_FINAL_HOLD",["HR","ADMIN"]),[f,v]=c.useState(!1),[y,H]=c.useState([]),[S,j]=c.useState({}),[I,b]=c.useState("");async function A(){if(u&&m("HR_FINAL_HOLD_LIST",["HR","ADMIN"])){v(!0);try{const t=(await _(l)).items||[];H(t),j(s=>{const n={...s};return t.forEach(i=>{n[i.candidateId]||(n[i.candidateId]={finalHoldAt:B(i.finalHoldAt),remark:i.finalHoldRemark||""})}),n})}catch(a){d.error((a==null?void 0:a.message)||"Failed to load")}finally{v(!1)}}}c.useEffect(()=>{A()},[u]);const k=c.useMemo(()=>y.length,[y]);async function L(a){if(!m("HR_HOLD_SCHEDULE",["HR","ADMIN"])){d.error("Not allowed");return}const t=S[a.candidateId]||{},s=String(t.finalHoldAt||"").trim();if(!s){d.error("Select date/time");return}const n=$(s);if(!n.ok){d.error(n.message);return}const i=n.date,R=`${a.candidateId}:SCHEDULE`;b(R);try{await W(l,{requirementId:a.requirementId,candidateId:a.candidateId,finalHoldAt:i.toISOString(),remark:String(t.remark||"").trim()}),d.success("Scheduled"),H(p=>p.map(N=>N.candidateId===a.candidateId?{...N,finalHoldAt:i.toISOString(),finalHoldRemark:String(t.remark||"").trim()}:N))}catch(p){d.error((p==null?void 0:p.message)||"Failed")}finally{b("")}}function w(a){if(!(a!=null&&a.cvFileId)){d.error("CV not available");return}M(a.cvFileId,l)||d.error("Unable to open CV")}return e.jsxs(F,{children:[u?null:e.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[e.jsx("div",{style:{fontWeight:700},children:"Not allowed"}),e.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"You donâ€™t have access to Final Hold portal."})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h1",{className:"page-title",children:"Final Hold Scheduling"}),e.jsx("p",{className:"page-subtitle",children:"Schedule final hold interviews for candidates"})]}),e.jsx("div",{className:"card",style:{marginBottom:"16px"},children:e.jsxs("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs("button",{className:"button",onClick:A,disabled:f,style:{display:"flex",alignItems:"center",gap:6},children:[f?e.jsx(C,{size:14}):null,"Refresh"]}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsxs("span",{className:"badge",children:[k," candidates"]})})]})}),f?e.jsx(E,{text:"Loading candidates..."}):e.jsx(O,{title:"Final Hold Candidates",subtitle:"Candidates awaiting final hold scheduling",badge:k,variant:"card",defaultOpen:!0,children:y.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"ðŸ“‹"}),e.jsx("div",{className:"empty-state-text",children:"No candidates in Final Hold"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:y.map(a=>{const t=S[a.candidateId]||{finalHoldAt:"",remark:""},s=I===`${a.candidateId}:SCHEDULE`;return e.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{minWidth:260,flex:1},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:"15px"},children:[D(a)||a.candidateId,D(a)&&a.candidateId?e.jsxs("span",{className:"small",style:{fontWeight:400,marginLeft:8,color:"var(--gray-500)"},children:["(",a.candidateId,")"]}):null]}),e.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[a.jobTitle?`${a.jobTitle} Â· `:"",a.jobRole||"-"]}),e.jsx(U,{sla:a.sla}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("span",{className:"badge",children:["Req: ",a.requirementId]}),e.jsx("span",{className:"badge",style:{background:"var(--primary)",color:"#fff"},children:String(a.status||"").toUpperCase()})]}),a.finalHoldAt?e.jsx("div",{style:{marginTop:8},children:e.jsxs("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:["ðŸ“… ",V(a.finalHoldAt)]})}):null,a.finalHoldRemark?e.jsxs("div",{className:"small",style:{marginTop:8,color:"var(--gray-600)"},children:["Remark: ",a.finalHoldRemark]}):null]}),e.jsxs("div",{style:{display:"grid",gap:10,minWidth:260},children:[e.jsxs("label",{className:"small",style:{display:"grid",gap:4},children:[e.jsx("span",{style:{fontWeight:600},children:"Schedule date/time"}),e.jsx("input",{type:"datetime-local",value:t.finalHoldAt,onChange:n=>j(i=>({...i,[a.candidateId]:{...t,finalHoldAt:n.target.value}}))})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:4},children:[e.jsx("span",{style:{fontWeight:600},children:"Remark (optional)"}),e.jsx("input",{value:t.remark,onChange:n=>j(i=>({...i,[a.candidateId]:{...t,remark:n.target.value}})),placeholder:"Enter remark"})]}),e.jsxs("div",{className:"action-grid",children:[e.jsx("button",{className:"button",type:"button",onClick:()=>w(a),children:"ðŸ“„ View CV"}),e.jsxs("button",{className:"button primary",type:"button",onClick:()=>L(a),disabled:s||!!I||!m("HR_HOLD_SCHEDULE",["HR","ADMIN"]),children:[s?e.jsx(C,{size:14}):null,"Schedule"]})]})]})]})},a.candidateId)})})})]})}export{Q as FinalHoldPage};
