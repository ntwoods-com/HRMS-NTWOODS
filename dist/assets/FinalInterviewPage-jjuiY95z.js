import{a as q,r as d,j as e,A as G,S as D,M,a2 as V,n as g,a3 as $,R as H}from"./index-grL27em3.js";import{C as R}from"./Collapsible-0ER5Bbk1.js";import{S as P}from"./SlaCountdown-DTF7N97H.js";import{V as _}from"./ViewCvButton-Cqus7HoZ.js";import{c as N}from"./pii-BcFV6mqh.js";import"./useNowTick-_9wyDYsU.js";import"./files-CjotXup9.js";function O(i){const l=String(i||"").toUpperCase();return l==="APPROVED"?{background:"#22c55e",color:"#fff"}:l==="REJECTED"?{background:"#ef4444",color:"#fff"}:l==="REVIEW_PENDING"?{background:"#f59e0b",color:"#fff"}:l==="PENDING"?{background:"var(--gray-200)",color:"var(--gray-800)"}:{background:"var(--gray-100)",color:"var(--gray-700)"}}function W(i){const l=String(i||"").toUpperCase();return l==="APPROVED"?"PASS":l==="REJECTED"?"FAIL":l==="REVIEW_PENDING"?"REVIEW PENDING":l==="NOT_SELECTED"?"NOT SELECTED":l||"-"}function X(){const{token:i,role:l,legacyRole:I,canPortal:j,canAction:v}=q();function k(s,r){const a=typeof j=="function"?j(s):null;if(a===!0||a===!1)return a;const n=String(I||l||"").toUpperCase();return Array.isArray(r)?r.includes(n):!1}function u(s,r){const a=typeof v=="function"?v(s):null;if(a===!0||a===!1)return a;const n=String(I||l||"").toUpperCase();return Array.isArray(r)?r.includes(n):!1}const p=k("PORTAL_HR_FINAL",["HR","ADMIN"]),[y,b]=d.useState(!1),[o,E]=d.useState([]),[x,h]=d.useState("PASSED"),[S,w]=d.useState(""),[c,A]=d.useState({});async function C(s){if(!p||!u("CANDIDATE_TESTS_GET",["HR","ADMIN"]))return;if(!Array.isArray(s)||s.length===0){A({});return}const r=s.map(t=>H(i,{requirementId:t.requirementId,candidateId:t.candidateId}).then(L=>[t.candidateId,L]).catch(()=>null)),a=await Promise.all(r),n={};for(const t of a)t&&(n[t[0]]=t[1]);A(n)}async function T(){if(p&&u("FINAL_INTERVIEW_LIST",["HR","ADMIN"])){b(!0);try{const r=(await V(i)).items??[];E(r),await C(r)}catch(s){g.error((s==null?void 0:s.message)||"Failed to load")}finally{b(!1)}}}d.useEffect(()=>{T()},[p]);const m=d.useMemo(()=>o.filter(s=>String(s.status||"").toUpperCase()!=="FINAL_OWNER_PENDING"),[o]),f=d.useMemo(()=>o.filter(s=>String(s.status||"").toUpperCase()==="FINAL_OWNER_PENDING"),[o]);async function F(s){if(!u("FINAL_SEND_OWNER",["HR","ADMIN"])){g.error("Not allowed");return}const r=`${s.requirementId}:${s.candidateId}:SEND_OWNER`;w(r);try{await $(i,{requirementId:s.requirementId,candidateId:s.candidateId}),g.success("Sent to Owner"),E(a=>a.map(n=>n.candidateId===s.candidateId?{...n,status:"FINAL_OWNER_PENDING"}:n)),h("PENDING_OWNER")}catch(a){g.error((a==null?void 0:a.message)||"Failed")}finally{w("")}}return e.jsxs(G,{children:[p?null:e.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[e.jsx("div",{style:{fontWeight:700},children:"Not allowed"}),e.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"You don’t have access to Final Interview portal."})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h1",{className:"page-title",children:"Final Interview"}),e.jsx("p",{className:"page-subtitle",children:"Candidates eligible for final interview"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"16px"},children:[e.jsxs("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs("button",{className:"button",onClick:T,disabled:y,style:{display:"flex",alignItems:"center",gap:6},children:[y?e.jsx(D,{size:14}):null,"Refresh"]}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsxs("span",{className:"badge",children:[o.length," candidates"]})})]}),e.jsx("div",{style:{height:12}}),e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{type:"button",className:["tab",x==="PASSED"?"active":""].join(" "),onClick:()=>h("PASSED"),children:["Passed (",m.length,")"]}),e.jsxs("button",{type:"button",className:["tab",x==="PENDING_OWNER"?"active":""].join(" "),onClick:()=>h("PENDING_OWNER"),children:["Pending Owner (",f.length,")"]})]})]}),y?e.jsx(M,{text:"Loading candidates..."}):e.jsx(e.Fragment,{children:x==="PASSED"?e.jsx(R,{title:"Ready for Final Interview",subtitle:"Send these candidates to Owner for final interview",badge:m.length,variant:"card",defaultOpen:!0,children:m.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"✅"}),e.jsx("div",{className:"empty-state-text",children:"No candidates ready"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:m.map(s=>{var n;const r=`${s.requirementId}:${s.candidateId}:SEND_OWNER`,a=((n=c==null?void 0:c[s.candidateId])==null?void 0:n.requiredTests)??[];return e.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:e.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:700,fontSize:"15px"},children:[N(s)||s.candidateId,N(s)&&s.candidateId?e.jsxs("span",{className:"small",style:{fontWeight:400,marginLeft:8,color:"var(--gray-500)"},children:["(",s.candidateId,")"]}):null]}),e.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[s.jobTitle?`${s.jobTitle} · `:"",s.jobRole||"-"]}),e.jsx(P,{sla:s.sla}),e.jsxs("div",{style:{marginTop:6,display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:["In-person: ",s.inPersonMarks,"/10"]}),Array.isArray(a)&&a.length?a.map(t=>e.jsxs("span",{className:"badge",style:O(t.status),children:[t.label||t.testKey,": ",W(t.status),t.marksNumber!=null?` (${t.marksNumber}/10)`:""]},t.testKey)):e.jsx("span",{className:"badge",children:"No required tests"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx(_,{cvFileId:s.cvFileId,token:i}),e.jsxs("button",{className:"button primary",type:"button",onClick:()=>F(s),disabled:!!S||!u("FINAL_SEND_OWNER",["HR","ADMIN"]),children:[S===r?e.jsx(D,{size:14}):null,"Send to Owner"]})]})]})},s.candidateId)})})}):e.jsx(R,{title:"Pending Final Interview (Owner)",subtitle:"Waiting for Owner's final decision",badge:f.length,variant:"card",defaultOpen:!0,children:f.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"⏳"}),e.jsx("div",{className:"empty-state-text",children:"No candidates pending"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:f.map(s=>{var a;const r=((a=c==null?void 0:c[s.candidateId])==null?void 0:a.requiredTests)??[];return e.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:"15px"},children:[N(s)||s.candidateId,N(s)&&s.candidateId?e.jsxs("span",{className:"small",style:{fontWeight:400,marginLeft:8,color:"var(--gray-500)"},children:["(",s.candidateId,")"]}):null]}),e.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[s.jobTitle?`${s.jobTitle} · `:"",s.jobRole||"-"]}),e.jsx(P,{sla:s.sla}),e.jsx("div",{style:{marginTop:10},children:e.jsx(_,{cvFileId:s.cvFileId,token:i})}),e.jsxs("div",{style:{marginTop:6,display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:["In-person: ",s.inPersonMarks,"/10"]}),Array.isArray(r)&&r.length?r.map(n=>e.jsxs("span",{className:"badge",style:O(n.status),children:[n.label||n.testKey,": ",W(n.status),n.marksNumber!=null?` (${n.marksNumber}/10)`:""]},n.testKey)):e.jsx("span",{className:"badge",children:"No required tests"})]}),e.jsx("div",{style:{marginTop:12,padding:"10px 12px",background:"#fef3c7",borderRadius:"var(--radius)",fontSize:"13px"},children:"⏳ Pending Final Interview (Owner) — Locked"})]},s.candidateId)})})})})]})}export{X as FinalInterviewPage};
