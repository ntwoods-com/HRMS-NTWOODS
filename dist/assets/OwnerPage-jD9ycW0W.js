import{a as ie,r as m,j as t,A as le,S as N,M as de,D as r,N as oe,O as ce,P as z,Q as ue,R as me}from"./index-grL27em3.js";import{C as J}from"./Collapsible-0ER5Bbk1.js";import{v as pe}from"./scheduling-mgpGDE0C.js";import{o as Ne}from"./files-CjotXup9.js";import{c as E}from"./pii-BcFV6mqh.js";function G(i){if(!i)return"";const l=i instanceof Date?i:new Date(i);return Number.isNaN(l.getTime())?String(i):l.toLocaleString()}function fe(i){const l=String(i||"").toUpperCase();return l==="APPROVED"?{background:"#22c55e",color:"#fff"}:l==="REJECTED"?{background:"#ef4444",color:"#fff"}:l==="REVIEW_PENDING"?{background:"#f59e0b",color:"#fff"}:l==="PENDING"?{background:"var(--gray-200)",color:"var(--gray-800)"}:{background:"var(--gray-100)",color:"var(--gray-700)"}}function ge(i){const l=String(i||"").toUpperCase();return l==="APPROVED"?"PASS":l==="REJECTED"?"FAIL":l==="REVIEW_PENDING"?"REVIEW PENDING":l==="NOT_SELECTED"?"NOT SELECTED":l||"-"}function be(){var U,V,q,$,H,B,K;const{token:i,legacyRole:l,canPortal:w,canAction:k,canUi:T}=ie();function Q(e,a){const n=typeof w=="function"?w(e):null;if(n===!0||n===!1)return n;const s=String(l||"").toUpperCase();return(Array.isArray(a)?a:[]).includes(s)}function c(e,a){const n=typeof k=="function"?k(e):null;if(n===!0||n===!1)return n;const s=String(l||"").toUpperCase();return(Array.isArray(a)?a:[]).includes(s)}function S(e,a){const n=typeof T=="function"?T(e):null;if(n===!0||n===!1)return n;const s=String(l||"").toUpperCase();return(Array.isArray(a)?a:[]).includes(s)}function Y(e,a){try{const n=JSON.parse(String((e==null?void 0:e.testDecisionsJson)||"{}")),s=n==null?void 0:n[a];return String((s==null?void 0:s.decision)||"").toUpperCase()==="CONTINUE"}catch{return!1}}const X=m.useMemo(()=>[{key:"APPROVE",label:"Approve"},{key:"FINAL",label:"Final"}],[]),[L,Z]=m.useState("APPROVE"),[j,_]=m.useState(!1),[v,ee]=m.useState([]),[R,P]=m.useState({}),[d,g]=m.useState({open:!1,mode:"OWNER",candidate:null}),[A,O]=m.useState(""),[D,C]=m.useState(""),[u,p]=m.useState("");async function te(e){if(!c("CANDIDATE_TESTS_GET",["OWNER","ADMIN"]))return;if(!Array.isArray(e)||e.length===0){P({});return}const a=e.map(o=>me(i,{requirementId:o.requirementId,candidateId:o.candidateId}).then(h=>[o.candidateId,h]).catch(()=>null)),n=await Promise.all(a),s={};for(const o of n)o&&(s[o[0]]=o[1]);P(s)}async function y(){if(!c("OWNER_CANDIDATES_LIST",["OWNER","ADMIN"])){r.error("Not allowed");return}_(!0);try{const a=(await oe(i)).items||[];ee(a),await te(a.filter(n=>String((n==null?void 0:n.status)||"").toUpperCase()==="FINAL_OWNER_PENDING"))}catch(e){r.error((e==null?void 0:e.message)||"Failed to load")}finally{_(!1)}}m.useEffect(()=>{y()},[]);function ae(e){g({open:!0,mode:"OWNER",candidate:e}),O(""),C("")}function se(e){g({open:!0,mode:"FINAL",candidate:e}),O(""),C("")}function F(e){if(!(e!=null&&e.cvFileId)){r.error("CV not available");return}Ne(e.cvFileId,i)||r.error("Unable to open CV")}async function W(e){if(!c("OWNER_DECIDE",["OWNER","ADMIN"])){r.error("Not allowed");return}if(e==="APPROVE_WALKIN"&&!S("BTN_OWNER_APPROVE_WALKIN",["OWNER","ADMIN"])){r.error("Not allowed");return}const a=d.candidate;if(!a)return;const n=a.requirementId,s=a.candidateId,o=String(A||"").trim();let h=null;if(e==="REJECT"&&!o){r.error("Remark required");return}if(e==="HOLD"){if(!D){r.error("Select hold deadline");return}const f=pe(D);if(!f.ok){r.error(f.message);return}h=f.date}const x=`${s}:${e}`;p(x);try{await ue(i,{requirementId:n,candidateId:s,decision:e==="APPROVE_WALKIN"?"APPROVE_WALKIN":e,remark:o,holdUntil:e==="HOLD"?h.toISOString():void 0}),r.success("Updated"),g({open:!1,mode:"OWNER",candidate:null}),await y()}catch(f){r.error((f==null?void 0:f.message)||"Failed")}finally{p("")}}async function M(e){if(!c("OWNER_FINAL_DECIDE",["OWNER","ADMIN"])){r.error("Not allowed");return}const a=d.candidate;if(!a)return;const n=a.requirementId,s=a.candidateId,o=String(A||"").trim();if(e==="REJECT"&&!o){r.error("Remark required");return}const h=`${s}:FINAL:${e}`;p(h);try{await z(i,{requirementId:n,candidateId:s,decision:e,remark:o}),r.success("Updated"),g({open:!1,mode:"FINAL",candidate:null}),await y()}catch(x){r.error((x==null?void 0:x.message)||"Failed")}finally{p("")}}async function ne(e){if(!c("OWNER_FINAL_DECIDE",["OWNER","ADMIN"])){r.error("Not allowed");return}const a=`${e.candidateId}:FINAL:SELECT`;p(a);try{await z(i,{requirementId:e.requirementId,candidateId:e.candidateId,decision:"SELECT",remark:""}),r.success("Selected"),await y()}catch(n){r.error((n==null?void 0:n.message)||"Failed")}finally{p("")}}async function re(e){if(!c("HOLD_REVERT",["OWNER","ADMIN"])){r.error("Not allowed");return}const a=`${e.candidateId}:REVERT`;p(a);try{await ce(i,{requirementId:e.requirementId,candidateId:e.candidateId,remark:"Revert"}),r.success("Reverted"),await y()}catch(n){r.error((n==null?void 0:n.message)||"Revert failed")}finally{p("")}}const I=v.filter(e=>{const a=String(e.status||"").toUpperCase();return a==="OWNER"||a==="OWNER_HOLD"}),b=v.filter(e=>String(e.status||"").toUpperCase()==="FINAL_OWNER_PENDING");return t.jsxs(le,{children:[Q("PORTAL_OWNER",["OWNER","ADMIN"])?null:t.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[t.jsx("div",{style:{fontWeight:700},children:"Not allowed"}),t.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"You donâ€™t have access to Owner portal."})]}),t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("h1",{className:"page-title",children:"Owner Portal"}),t.jsx("p",{className:"page-subtitle",children:"Review and make decisions on candidates"})]}),t.jsxs("div",{className:"card",style:{marginBottom:"16px"},children:[t.jsxs("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[t.jsxs("button",{className:"button",onClick:y,disabled:j,style:{display:"flex",alignItems:"center",gap:6},children:[j?t.jsx(N,{size:14}):null,"Refresh"]}),t.jsx("div",{style:{marginLeft:"auto"},children:t.jsxs("span",{className:"badge",children:[v.length," candidates"]})})]}),t.jsx("div",{style:{height:12}}),t.jsx("div",{className:"tabs",children:X.map(e=>t.jsxs("button",{type:"button",className:["tab",L===e.key?"active":""].join(" "),onClick:()=>Z(e.key),children:[e.label," (",e.key==="APPROVE"?I.length:b.length,")"]},e.key))})]}),j?t.jsx(de,{text:"Loading candidates..."}):t.jsx(t.Fragment,{children:L==="APPROVE"?t.jsx(J,{title:"Candidates for Approval",subtitle:"Approve, hold, or reject candidate applications",badge:I.length,variant:"card",defaultOpen:!0,children:I.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state-icon",children:"ðŸ“‹"}),t.jsx("div",{className:"empty-state-text",children:"No candidates pending approval"})]}):t.jsx("div",{style:{display:"grid",gap:10},children:I.map(e=>{const a=String(e.status||"").toUpperCase(),n=a==="OWNER_HOLD",s=e.holdUntil?new Date(e.holdUntil).toLocaleString():"";return t.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:t.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontWeight:700,fontSize:"15px"},children:[E(e)||e.candidateId,E(e)&&e.candidateId?t.jsxs("span",{className:"small",style:{fontWeight:400,marginLeft:8,color:"var(--gray-500)"},children:["(",e.candidateId,")"]}):null]}),t.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[e.jobRole||"-"," Â· ",e.source||"-"]}),t.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[t.jsxs("span",{className:"badge",children:["Req: ",e.requirementId]}),t.jsx("span",{className:"badge",style:{background:n?"#f59e0b":"var(--primary)",color:"#fff"},children:a})]}),n&&s&&t.jsxs("div",{className:"small",style:{marginTop:6,color:"var(--gray-600)"},children:["â° Hold deadline: ",s]})]}),t.jsxs("div",{className:"action-grid",children:[t.jsx("button",{className:"button",type:"button",onClick:()=>F(e),children:"ðŸ“„ CV"}),n?t.jsxs("button",{className:"button",type:"button",onClick:()=>re(e),disabled:!!u||!c("HOLD_REVERT",["OWNER","ADMIN"]),children:[u===`${e.candidateId}:REVERT`?t.jsx(N,{size:14}):null,"Revert"]}):t.jsx("button",{className:"button primary",type:"button",onClick:()=>{if(!c("OWNER_DECIDE",["OWNER","ADMIN"])){r.error("Not allowed");return}ae(e)},disabled:!c("OWNER_DECIDE",["OWNER","ADMIN"]),children:"Actions"})]})]})},e.candidateId)})})}):t.jsx(J,{title:"Final Decision",subtitle:"Make final hiring decisions for candidates",badge:b.length,variant:"card",defaultOpen:!0,children:b.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state-icon",children:"âš–ï¸"}),t.jsx("div",{className:"empty-state-text",children:"No candidates pending final decision"})]}):t.jsx("div",{style:{display:"grid",gap:10},children:b.map(e=>{var n;const a=((n=R==null?void 0:R[e.candidateId])==null?void 0:n.requiredTests)??[];return t.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:t.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"flex-start"},children:[t.jsxs("div",{style:{minWidth:280,flex:1},children:[t.jsxs("div",{style:{fontWeight:700,fontSize:"15px"},children:[E(e)||e.candidateId,E(e)&&e.candidateId?t.jsxs("span",{className:"small",style:{fontWeight:400,marginLeft:8,color:"var(--gray-500)"},children:["(",e.candidateId,")"]}):null]}),t.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[e.jobTitle?`${e.jobTitle} Â· `:"",e.jobRole||"-"]}),t.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[t.jsxs("span",{className:"badge",children:["Req: ",e.requirementId]}),t.jsx("span",{className:"badge",style:{background:"var(--primary)",color:"#fff"},children:"Final Decision"})]}),t.jsxs("div",{style:{marginTop:12,padding:"10px 12px",background:"var(--gray-100)",borderRadius:"var(--radius)"},children:[t.jsx("div",{className:"small",style:{fontWeight:600,marginBottom:6},children:"Scores"}),t.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[t.jsxs("span",{className:"badge",style:{background:String(e.onlineTestResult||"").toUpperCase()==="PASS"?"#22c55e":String(e.onlineTestResult||"").toUpperCase()==="FAIL"?"#ef4444":void 0,color:String(e.onlineTestResult||"").toUpperCase()?"#fff":void 0},children:["Online Test: ",e.onlineTestScore===""||e.onlineTestScore==null?"-":e.onlineTestScore,e.onlineTestResult?` (${String(e.onlineTestResult).toUpperCase()})`:""]}),String(e.onlineTestResult||"").toUpperCase()==="FAIL"&&Y(e,"ONLINE_TEST")?t.jsx("span",{className:"badge",style:{background:"#f59e0b",color:"#fff"},children:"Continued by HR"}):null,e.preInterviewMarks&&t.jsxs("span",{className:"badge",children:["Pre-interview: ",e.preInterviewMarks]}),e.inPersonMarks&&t.jsxs("span",{className:"badge",children:["In-person: ",e.inPersonMarks]})]}),t.jsx("div",{className:"small",style:{marginTop:8,fontWeight:600},children:"Required Tests"}),t.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:6},children:Array.isArray(a)&&a.length?a.map(s=>t.jsxs("span",{className:"badge",style:fe(s.status),children:[s.label||s.testKey,": ",ge(s.status),s.marksNumber!=null?` (${s.marksNumber}/10)`:""]},s.testKey)):t.jsx("span",{className:"badge",children:"No required tests"})}),Array.isArray(a)&&a.length?t.jsx("div",{className:"small",style:{marginTop:6,display:"grid",gap:4},children:a.map(s=>t.jsxs("div",{children:[t.jsx("span",{style:{fontWeight:600},children:s.label||s.testKey}),s.filledAt?` Â· Filled: ${s.filledBy||"-"} (${G(s.filledAt)})`:"",s.reviewedAt?` Â· Reviewed: ${s.reviewedBy||"-"} (${G(s.reviewedAt)})`:"",s.remarks?` Â· ${s.remarks}`:""]},s.testKey))}):null]})]}),t.jsxs("div",{className:"action-grid",style:{minWidth:180},children:[t.jsx("button",{className:"button",type:"button",onClick:()=>F(e),children:"ðŸ“„ CV"}),t.jsxs("button",{className:"button primary",type:"button",onClick:()=>ne(e),disabled:!!u||!c("OWNER_FINAL_DECIDE",["OWNER","ADMIN"]),children:[u===`${e.candidateId}:FINAL:SELECT`?t.jsx(N,{size:14}):null,"Select"]}),t.jsx("button",{className:"button",type:"button",onClick:()=>{if(!c("OWNER_FINAL_DECIDE",["OWNER","ADMIN"])){r.error("Not allowed");return}se(e)},disabled:!c("OWNER_FINAL_DECIDE",["OWNER","ADMIN"]),children:"Hold / Reject"})]})]})},e.candidateId)})})})}),d.open&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>g({open:!1,mode:"OWNER",candidate:null}),children:t.jsxs("div",{className:"card",style:{width:"min(520px, 95vw)",maxHeight:"90vh",overflow:"auto"},onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{style:{marginTop:0,marginBottom:4},children:d.mode==="FINAL"?"Owner Final Decision":"Owner Decision"}),t.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginBottom:16},children:[E(d.candidate)||((U=d.candidate)==null?void 0:U.candidateId),E(d.candidate)&&((V=d.candidate)!=null&&V.candidateId)?` (${d.candidate.candidateId})`:""]}),t.jsxs("div",{style:{display:"grid",gap:12},children:[d.mode!=="FINAL"&&t.jsxs("div",{children:[t.jsx("label",{className:"small",style:{fontWeight:600,display:"block",marginBottom:4},children:"Hold deadline (required for Hold)"}),t.jsx("input",{type:"datetime-local",value:D,onChange:e=>C(e.target.value),style:{width:"100%"}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"small",style:{fontWeight:600,display:"block",marginBottom:4},children:"Remark (required for Reject)"}),t.jsx("textarea",{rows:3,value:A,onChange:e=>O(e.target.value),style:{width:"100%"},placeholder:"Enter remark..."})]})]}),t.jsxs("div",{style:{marginTop:16,display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[d.mode==="FINAL"?t.jsxs(t.Fragment,{children:[t.jsxs("button",{className:"button",type:"button",onClick:()=>M("HOLD"),disabled:!!u,children:[u===`${(q=d.candidate)==null?void 0:q.candidateId}:FINAL:HOLD`?t.jsx(N,{size:14}):null,"Hold"]}),t.jsxs("button",{className:"button danger",type:"button",onClick:()=>M("REJECT"),disabled:!!u,children:[u===`${($=d.candidate)==null?void 0:$.candidateId}:FINAL:REJECT`?t.jsx(N,{size:14}):null,"Reject"]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("button",{className:"button primary",type:"button",onClick:()=>W("APPROVE_WALKIN"),disabled:!!u||!c("OWNER_DECIDE",["OWNER","ADMIN"])||!S("BTN_OWNER_APPROVE_WALKIN",["OWNER","ADMIN"]),children:[u===`${(H=d.candidate)==null?void 0:H.candidateId}:APPROVE_WALKIN`?t.jsx(N,{size:14}):null,"Approve"]}),t.jsxs("button",{className:"button",type:"button",onClick:()=>W("HOLD"),disabled:!!u||!c("OWNER_DECIDE",["OWNER","ADMIN"]),children:[u===`${(B=d.candidate)==null?void 0:B.candidateId}:HOLD`?t.jsx(N,{size:14}):null,"Hold"]}),t.jsxs("button",{className:"button danger",type:"button",onClick:()=>W("REJECT"),disabled:!!u||!c("OWNER_DECIDE",["OWNER","ADMIN"]),children:[u===`${(K=d.candidate)==null?void 0:K.candidateId}:REJECT`?t.jsx(N,{size:14}):null,"Reject"]})]}),t.jsx("button",{className:"button",type:"button",onClick:()=>g({open:!1,mode:"OWNER",candidate:null}),children:"Close"})]})]})})]})}export{be as OwnerPage};
