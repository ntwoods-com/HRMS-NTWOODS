import{r as y,j as e,S as T,n as i,u as xe,a as be,A as je,M as Te,ab as Re,ac as ve,ad as Z,ae as Ae}from"./index-grL27em3.js";import{b as Ee,t as Ce,c as ke,d as Oe,e as Se,f as De,u as ee}from"./training-CjQMu29P.js";import{C as _e}from"./Collapsible-0ER5Bbk1.js";import{S as we}from"./SlaCountdown-DTF7N97H.js";import{T as Pe}from"./TrainingList-BS7WbGfL.js";import{o as Le}from"./files-CjotXup9.js";import{c as H}from"./pii-BcFV6mqh.js";import{u as Me}from"./useNowTick-_9wyDYsU.js";function _({label:h,value:c,color:R}){return e.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:[e.jsx("div",{className:"small",style:{color:"var(--gray-500)"},children:h}),e.jsx("div",{style:{fontWeight:800,marginTop:6,color:R||"inherit"},children:c})]})}function Ge({token:h,scope:c="PROBATION"}){const[R,j]=y.useState(!1),[x,v]=y.useState(null);async function A(){j(!0);try{const g=await Ee(h,{scope:c});v(g)}catch(g){i.error((g==null?void 0:g.message)||"Failed to load training dashboard"),v(null)}finally{j(!1)}}y.useEffect(()=>{A()},[c]);const d=(x==null?void 0:x.totals)||{TOTAL:0,PENDING:0,IN_PROGRESS:0,COMPLETED:0,OVERDUE:0},f=y.useMemo(()=>(Array.isArray(x==null?void 0:x.candidates)?x.candidates:[]).filter(P=>Number(P.OVERDUE||0)>0).slice(0,8),[x]);return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:800},children:"Training Dashboard"}),e.jsxs("div",{className:"small",style:{color:"var(--gray-500)"},children:["Counts by status (scope: ",String(c).toUpperCase(),")"]})]}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsxs("button",{className:"button",type:"button",onClick:A,disabled:R,children:[R?e.jsx(T,{size:14}):null,"Refresh"]})})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10},children:[e.jsx(_,{label:"Total",value:d.TOTAL||0}),e.jsx(_,{label:"Pending",value:d.PENDING||0,color:"#f59e0b"}),e.jsx(_,{label:"In-Progress",value:d.IN_PROGRESS||0,color:"#3b82f6"}),e.jsx(_,{label:"Completed",value:d.COMPLETED||0,color:"#22c55e"}),e.jsx(_,{label:"Overdue",value:d.OVERDUE||0,color:"#ef4444"})]}),f.length?e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"small",style:{fontWeight:700,marginBottom:8},children:"Overdue (top)"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:8},children:f.map(g=>e.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:[e.jsx("div",{style:{fontWeight:700},children:g.candidate_name||g.candidate_id}),e.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:["Overdue: ",g.OVERDUE," â€¢ Pending: ",g.PENDING," â€¢ In-Progress: ",g.IN_PROGRESS," â€¢ Completed: ",g.COMPLETED]})]},g.candidate_id))})]}):null]})}function w(h){if(!h)return"-";const c=h instanceof Date?h:new Date(h);return Number.isNaN(c.getTime())?String(h):c.toLocaleString()}function Be(h){if(!Number.isFinite(h))return"-";const c=h<0?"-":"",R=Math.abs(h),j=Math.floor(R/1e3),x=Math.floor(j/(3600*24)),v=Math.floor(j%(3600*24)/3600),A=Math.floor(j%3600/60),d=j%60,f=[];return x&&f.push(`${x}d`),f.push(`${String(v).padStart(2,"0")}h`),f.push(`${String(A).padStart(2,"0")}m`),f.push(`${String(d).padStart(2,"0")}s`),`${c}${f.join(" ")}`}function Je(){const h=xe(),{token:c,role:R,legacyRole:j,canPortal:x,canAction:v}=be();function A(a,s){const n=typeof x=="function"?x(a):null;if(n===!0||n===!1)return n;const t=String(j||R||"").toUpperCase();return Array.isArray(s)?s.includes(t):!1}function d(a,s){const n=typeof v=="function"?v(a):null;if(n===!0||n===!1)return n;const t=String(j||R||"").toUpperCase();return Array.isArray(s)?s.includes(t):!1}const f=A("PORTAL_HR_PROBATION",["HR","EA","ADMIN"]),[g,P]=y.useState(!1),[L,ae]=y.useState([]),[I,u]=y.useState(""),[M,S]=y.useState({}),q=Me(),[ne,V]=y.useState([]),[se,z]=y.useState(!1),[G,J]=y.useState({}),[te,K]=y.useState({}),[Y,E]=y.useState({}),[C,B]=y.useState({}),re=d("ROLE_CHANGE",["ADMIN","EA"]);function U(a){const s=G==null?void 0:G[a];if(s==null)return{ok:!1,reason:"Load trainings first"};const n=Array.isArray(s)?s:[];if(!n.length)return{ok:!1,reason:"Training not assigned"};if(n.reduce((m,N)=>String((N==null?void 0:N.status)||"").toUpperCase()!=="COMPLETED"?m+1:m,0)>0)return{ok:!1,reason:"Training pending"};const r=C==null?void 0:C[a];return r!=null&&r.closedAt?{ok:!0,reason:""}:{ok:!1,reason:"Close Training required"}}async function ie(){if(f&&d("TRAINING_MASTER_LIST",["HR","ADMIN"])){z(!0);try{const a=await Ce(c);V(a.items??[])}catch(a){i.error((a==null?void 0:a.message)||"Failed to load training templates"),V([])}finally{z(!1)}}}async function k(){if(f&&d("PROBATION_LIST",["HR","EA","ADMIN"])){P(!0);try{const s=(await Re(c)).items||[];ae(s),B(n=>{const t={...n};return s.forEach(r=>{r!=null&&r.candidateId&&(r!=null&&r.trainingState)&&(t[r.candidateId]=r.trainingState)}),t}),S(n=>{const t={...n};return s.forEach(r=>{t[r.candidateId]?t[r.candidateId]={probationDays:t[r.candidateId].probationDays??90,rejectRemark:t[r.candidateId].rejectRemark??"",newJobRole:t[r.candidateId].newJobRole??(r.jobRole||""),roleChangeRemark:t[r.candidateId].roleChangeRemark??""}:t[r.candidateId]={probationDays:90,rejectRemark:"",newJobRole:r.jobRole||"",roleChangeRemark:""}}),t})}catch(a){i.error((a==null?void 0:a.message)||"Failed to load")}finally{P(!1)}}}y.useEffect(()=>{k()},[f]),y.useEffect(()=>{ie()},[f]);const Q=y.useMemo(()=>L.length,[L]);async function le(a){if(!d("PROBATION_SET",["HR","EA","ADMIN"])){i.error("Not allowed");return}const s=M[a.candidateId]||{},n=Number(s.probationDays||0);if(!Number.isFinite(n)||n<=0){i.error("Enter probation days");return}const t=`${a.candidateId}:PROBATION_SET`;u(t);try{await ve(c,{requirementId:a.requirementId,candidateId:a.candidateId,probationDays:n}),i.success("Probation set"),await k()}catch(r){i.error((r==null?void 0:r.message)||"Failed")}finally{u("")}}async function de(a){if(!d("PROBATION_DECIDE",["HR","EA","ADMIN"])){i.error("Not allowed");return}const s=M[a.candidateId]||{},n=String(s.rejectRemark||"").trim();if(!n){i.error("Remark is required");return}const t=`${a.candidateId}:PROBATION_REJECT`;u(t);try{await Z(c,{requirementId:a.requirementId,candidateId:a.candidateId,decision:"REJECT",remark:n}),i.success("Rejected"),await k()}catch(r){i.error((r==null?void 0:r.message)||"Failed")}finally{u("")}}async function oe(a){if(!d("PROBATION_DECIDE",["HR","EA","ADMIN"])){i.error("Not allowed");return}const s=`${a.candidateId}:PROBATION_COMPLETE`;u(s);try{const n=await Z(c,{requirementId:a.requirementId,candidateId:a.candidateId,decision:"COMPLETE",remark:""});if(i.success("Probation completed"),n!=null&&n.employeeId){h(`/employee/${encodeURIComponent(n.employeeId)}`);return}await k()}catch(n){i.error((n==null?void 0:n.message)||"Failed")}finally{u("")}}async function ce(a){if(!d("ROLE_CHANGE",["ADMIN","EA"])){i.error("Not allowed");return}const s=M[a.candidateId]||{},n=String(s.newJobRole||"").trim(),t=String(s.roleChangeRemark||"").trim();if(!n){i.error("Enter new job role");return}const r=`${a.candidateId}:ROLE_CHANGE`;u(r);try{await Ae(c,{requirementId:a.requirementId,candidateId:a.candidateId,jobRole:n,remark:t}),i.success("Role updated (probation reset)"),await k()}catch(m){i.error((m==null?void 0:m.message)||"Failed")}finally{u("")}}function me(a){if(!a)return;Le(a,c)||i.error("Unable to open file")}async function $(a){if(!d("TRAINING_LIST",["HR","ADMIN","EA"])){i.error("Not allowed");return}K(s=>({...s,[a]:!0}));try{const s=await Se(c,{candidateId:a});J(n=>({...n,[a]:s.items??[]})),s!=null&&s.state&&B(n=>({...n,[a]:s.state}))}catch(s){i.error((s==null?void 0:s.message)||"Failed to load trainings"),J(n=>({...n,[a]:[]}))}finally{K(s=>({...s,[a]:!1}))}}async function ge(a){if(!d("TRAINING_ASSIGN",["HR","ADMIN"])){i.error("Not allowed");return}const s=Y[a.candidateId]||{},n=String(s.training_id||"").trim(),t=String(s.due_date||"").trim();if(!n){i.error("Select training");return}if(!t){i.error("Select due date");return}const r=new Date(t+"T23:59:59").toISOString(),m=`${a.candidateId}:TRAINING_ASSIGN`;u(m);try{await De(c,{candidate_id:a.candidateId,training_id:n,due_date:r,video_link:String(s.video_link||"").trim(),description:String(s.description||"").trim(),documentsLines:String(s.documentsLines||"")}),i.success("Training assigned"),E(N=>({...N,[a.candidateId]:{...N[a.candidateId],due_date:"",video_link:"",description:"",documentsLines:""}})),await $(a.candidateId)}catch(N){i.error((N==null?void 0:N.message)||"Assign failed")}finally{u("")}}async function ue(a,s){if(!d("TRAINING_STATUS_UPDATE",["HR","ADMIN"])){i.error("Not allowed");return}const n=`${a}:TRAINING_START:${s.assigned_id}`;u(n);try{await ee(c,{candidate_id:a,assigned_id:s.assigned_id,op:"START",remarks:""}),i.success("Marked In-Progress"),await $(a)}catch(t){i.error((t==null?void 0:t.message)||"Failed")}finally{u("")}}async function pe(a,s){if(!d("TRAINING_STATUS_UPDATE",["HR","ADMIN"])){i.error("Not allowed");return}const n=`${a}:TRAINING_COMPLETE:${s.assigned_id}`;u(n);try{await ee(c,{candidate_id:a,assigned_id:s.assigned_id,op:"COMPLETE",remarks:""}),i.success("Completed"),await $(a)}catch(t){i.error((t==null?void 0:t.message)||"Failed")}finally{u("")}}async function ye(a){if(!d("TRAINING_MARK_COMPLETE",["HR","EA","ADMIN"])){i.error("Not allowed");return}const s=`${a.candidateId}:TRAINING_MARK_COMPLETE`;u(s);try{const n=await ke(c,{requirementId:a.requirementId,candidateId:a.candidateId});B(t=>({...t,[a.candidateId]:n})),i.success("Training marked complete")}catch(n){i.error((n==null?void 0:n.message)||"Failed")}finally{u("")}}async function he(a){if(!d("TRAINING_CLOSE",["HR","EA","ADMIN"])){i.error("Not allowed");return}const s=`${a.candidateId}:TRAINING_CLOSE`;u(s);try{const n=await Oe(c,{requirementId:a.requirementId,candidateId:a.candidateId});if(n!=null&&n.closed){B(m=>({...m,[a.candidateId]:n})),i.success("Training closed");return}const t=(n==null?void 0:n.pending)??[],r=Array.isArray(t)?t.map(m=>m.training_name||m.training_name||m.training_id).filter(Boolean):[];i.error(r.length?`Pending trainings: ${r.join(", ")}`:"Training pending")}catch(n){i.error((n==null?void 0:n.message)||"Failed")}finally{u("")}}return e.jsxs(je,{children:[f?null:e.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[e.jsx("div",{style:{fontWeight:700},children:"Not allowed"}),e.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"You donâ€™t have access to Probation portal."})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h1",{className:"page-title",children:"Probation"}),e.jsx("p",{className:"page-subtitle",children:"Manage employee probation period and decisions"})]}),f&&d("TRAINING_DASHBOARD",["HR","ADMIN"])?e.jsx("div",{style:{marginBottom:16},children:e.jsx(Ge,{token:c,scope:"PROBATION"})}):null,e.jsx("div",{className:"card",style:{marginBottom:"16px"},children:e.jsxs("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs("button",{className:"button",onClick:k,disabled:g,style:{display:"flex",alignItems:"center",gap:6},children:[g?e.jsx(T,{size:14}):null,"Refresh"]}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsxs("span",{className:"badge",children:[Q," candidates"]})})]})}),g?e.jsx(Te,{text:"Loading candidates..."}):e.jsx(_e,{title:"Probation Candidates",subtitle:"Set probation, make decisions, or change roles",badge:Q,variant:"card",defaultOpen:!0,children:L.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"ðŸ‘¥"}),e.jsx("div",{className:"empty-state-text",children:"No candidates in Probation flow"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12},children:L.map(a=>{const s=String(a.status||"").toUpperCase(),n=s==="JOINED",t=s==="PROBATION",r=a.probationEndsAt?new Date(a.probationEndsAt):null,m=r&&!Number.isNaN(r.getTime())?r.getTime()-q:null,N=M[a.candidateId]||{},O=Y[a.candidateId]||{},D=G[a.candidateId]||[],W=!!te[a.candidateId],X=d("TRAINING_ASSIGN",["HR","ADMIN"]),fe=d("TRAINING_LIST",["HR","ADMIN","EA"]),Ie=d("TRAINING_STATUS_UPDATE",["HR","ADMIN"]),b=D.reduce((l,o)=>{const F=String((o==null?void 0:o.status)||"").toUpperCase();return l.TOTAL+=1,F==="COMPLETED"?l.COMPLETED+=1:F==="IN_PROGRESS"?l.IN_PROGRESS+=1:F==="OVERDUE"?l.OVERDUE+=1:l.PENDING+=1,l},{TOTAL:0,PENDING:0,IN_PROGRESS:0,COMPLETED:0,OVERDUE:0}),p=(C==null?void 0:C[a.candidateId])||null,Ne=!!b.TOTAL&&b.PENDING+b.IN_PROGRESS+b.OVERDUE===0;return e.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:[e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:12,flexWrap:"wrap",marginBottom:16},children:[e.jsxs("div",{style:{flex:1,minWidth:240},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:"16px"},children:[H(a)||a.candidateId,H(a)&&a.candidateId?e.jsxs("span",{className:"small",style:{fontWeight:400,marginLeft:8,color:"var(--gray-500)"},children:["(",a.candidateId,")"]}):null]}),e.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[a.jobTitle?`${a.jobTitle} Â· `:"",a.jobRole||"-"]}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("span",{className:"badge",children:["Req: ",a.requirementId]}),e.jsx("span",{className:"badge",style:{background:t?"#f59e0b":n?"#22c55e":"var(--primary)",color:"#fff"},children:a.status})]}),e.jsx(we,{sla:a.sla,nowMs:q})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{className:"small",style:{color:"var(--gray-500)"},children:"Joined At"}),e.jsx("div",{style:{fontWeight:600,fontSize:"14px",marginTop:2},children:w(a.joinedAt)}),t&&m!=null&&e.jsx("div",{style:{marginTop:8},children:e.jsxs("span",{className:"badge",style:{background:m<0?"#ef4444":m<7*24*60*60*1e3?"#f59e0b":"#22c55e",color:"#fff",fontFamily:"monospace"},children:["â± ",Be(m)]})})]})]}),t&&e.jsxs("div",{style:{marginBottom:16,padding:"10px 12px",background:"var(--gray-100)",borderRadius:"var(--radius)",fontSize:"13px"},children:[e.jsx("strong",{children:"Probation Period:"})," ",w(a.probationStartAt)," â†’ ",w(a.probationEndsAt)]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16},children:[e.jsx("button",{className:"button",type:"button",onClick:()=>me(a.cvFileId),disabled:!a.cvFileId,children:"ðŸ“„ View CV"}),a.employeeId&&e.jsx("button",{className:"button",type:"button",onClick:()=>h(`/employee/${encodeURIComponent(a.employeeId)}`),children:"ðŸ‘¤ View Employee"})]}),n&&e.jsxs("div",{style:{padding:"12px",background:"var(--gray-50)",borderRadius:"var(--radius)",marginBottom:12},children:[e.jsx("div",{className:"small",style:{fontWeight:700,marginBottom:8},children:"ðŸ“… Set Probation"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap",alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1,minWidth:140},children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"Probation Days"}),e.jsx("input",{value:N.probationDays??"",onChange:l=>S(o=>({...o,[a.candidateId]:{...o[a.candidateId],probationDays:l.target.value}})),placeholder:"90",style:{width:"100%"}})]}),e.jsxs("button",{className:"button primary",type:"button",onClick:()=>le(a),disabled:!!I||!d("PROBATION_SET",["HR","EA","ADMIN"]),children:[I===`${a.candidateId}:PROBATION_SET`?e.jsx(T,{size:14}):null,"Set Probation"]})]})]}),t&&e.jsxs("div",{style:{padding:"12px",background:"var(--gray-50)",borderRadius:"var(--radius)",marginBottom:12},children:[e.jsx("div",{className:"small",style:{fontWeight:700,marginBottom:8},children:"Training Closure"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("button",{className:"button",type:"button",onClick:()=>ye(a),disabled:!!I||!d("TRAINING_MARK_COMPLETE",["HR","EA","ADMIN"]),children:[I===`${a.candidateId}:TRAINING_MARK_COMPLETE`?e.jsx(T,{size:14}):null,"Mark Training Complete"]}),e.jsxs("button",{className:"button primary",type:"button",onClick:()=>he(a),disabled:!!I||!d("TRAINING_CLOSE",["HR","EA","ADMIN"])||!(p!=null&&p.markedCompleteAt),children:[I===`${a.candidateId}:TRAINING_CLOSE`?e.jsx(T,{size:14}):null,"Close Training"]}),p!=null&&p.closedAt?e.jsx("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:"Closed"}):p!=null&&p.markedCompleteAt?e.jsx("span",{className:"badge",style:{background:"#f59e0b",color:"#fff"},children:"Marked Complete"}):e.jsx("span",{className:"badge",children:"Not Closed"})]}),Ne?null:e.jsx("div",{className:"small",style:{marginTop:8,color:"var(--gray-600)"},children:"Finish all trainings to enable closure."}),p!=null&&p.markedCompleteAt?e.jsxs("div",{className:"small",style:{marginTop:8,color:"var(--gray-600)"},children:["Marked: ",w(p.markedCompleteAt)]}):null,p!=null&&p.closedAt?e.jsxs("div",{className:"small",style:{marginTop:4,color:"var(--gray-600)"},children:["Closed: ",w(p.closedAt)]}):null]}),t&&e.jsxs("div",{style:{padding:"12px",background:"var(--gray-50)",borderRadius:"var(--radius)",marginBottom:12},children:[e.jsx("div",{className:"small",style:{fontWeight:700,marginBottom:8},children:"âš–ï¸ Decision"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap",alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1,minWidth:200},children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"Reject Remark"}),e.jsx("input",{value:N.rejectRemark??"",onChange:l=>S(o=>({...o,[a.candidateId]:{...o[a.candidateId],rejectRemark:l.target.value}})),placeholder:"Reason for rejection",style:{width:"100%"}})]}),e.jsxs("button",{className:"button danger",type:"button",onClick:()=>de(a),disabled:!!I||!d("PROBATION_DECIDE",["HR","EA","ADMIN"]),children:[I===`${a.candidateId}:PROBATION_REJECT`?e.jsx(T,{size:14}):null,"Reject"]}),e.jsxs("button",{className:"button primary",type:"button",onClick:()=>oe(a),disabled:!!I||!d("PROBATION_DECIDE",["HR","EA","ADMIN"])||!U(a.candidateId).ok,children:[I===`${a.candidateId}:PROBATION_COMPLETE`?e.jsx(T,{size:14}):null,"Complete"]})]})]}),U(a.candidateId).ok?null:e.jsxs("div",{className:"small",style:{marginTop:6,color:"var(--gray-600)"},children:["Probation complete disabled: ",U(a.candidateId).reason,"."]}),re&&e.jsxs("div",{style:{padding:"12px",background:"#fef3c7",borderRadius:"var(--radius)"},children:[e.jsx("div",{className:"small",style:{fontWeight:700,marginBottom:4},children:"ðŸ”„ Role Change"}),e.jsx("div",{className:"small",style:{marginBottom:8,color:"var(--gray-600)"},children:"Updates role and restarts probation"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap",alignItems:"flex-end"},children:[e.jsxs("div",{style:{minWidth:160},children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"New Job Role"}),e.jsx("input",{value:N.newJobRole??"",onChange:l=>S(o=>({...o,[a.candidateId]:{...o[a.candidateId],newJobRole:l.target.value}})),placeholder:"EA / HR / ...",style:{width:"100%"}})]}),e.jsxs("div",{style:{flex:1,minWidth:160},children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"Remark"}),e.jsx("input",{value:N.roleChangeRemark??"",onChange:l=>S(o=>({...o,[a.candidateId]:{...o[a.candidateId],roleChangeRemark:l.target.value}})),placeholder:"Optional",style:{width:"100%"}})]}),e.jsxs("button",{className:"button",type:"button",onClick:()=>ce(a),disabled:!!I||!d("ROLE_CHANGE",["ADMIN","EA"]),children:[I===`${a.candidateId}:ROLE_CHANGE`?e.jsx(T,{size:14}):null,"Change Role"]})]})]}),e.jsx("div",{style:{height:12}}),e.jsxs("div",{style:{padding:"12px",background:"var(--gray-50)",borderRadius:"var(--radius)"},children:[e.jsxs("div",{className:"row",style:{alignItems:"center",gap:10,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"small",style:{fontWeight:800},children:"ðŸ“š Trainings"}),e.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"Assign trainings and track status"})]}),D.length?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("span",{className:"badge",children:["Total: ",b.TOTAL]}),e.jsxs("span",{className:"badge",style:{background:"#f59e0b",color:"#fff"},children:["Pending: ",b.PENDING]}),e.jsxs("span",{className:"badge",style:{background:"#3b82f6",color:"#fff"},children:["In-Progress: ",b.IN_PROGRESS]}),e.jsxs("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:["Completed: ",b.COMPLETED]}),e.jsxs("span",{className:"badge",style:{background:"#ef4444",color:"#fff"},children:["Overdue: ",b.OVERDUE]})]}):null,e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{className:"button",type:"button",onClick:()=>$(a.candidateId),disabled:W||!fe,children:[W?e.jsx(T,{size:14}):null,D.length?"Refresh Trainings":"Load Trainings"]}),D.length?e.jsx("button",{className:"button",type:"button",onClick:async()=>{const l=[`Candidate: ${H(a)||a.candidateId}${H(a)&&a.candidateId?` (${a.candidateId})`:""}`,`Training Summary: Total=${b.TOTAL}, Completed=${b.COMPLETED}, Pending=${b.PENDING}, In-Progress=${b.IN_PROGRESS}, Overdue=${b.OVERDUE}`];try{await navigator.clipboard.writeText(l.join(`
`)),i.success("Summary copied")}catch{i.error("Copy failed")}},disabled:W,children:"Copy Summary"}):null]})]}),X?e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"small",style:{fontWeight:700,marginBottom:8},children:"Assign Training"}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap",alignItems:"flex-end"},children:[e.jsxs("div",{style:{minWidth:220},children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"Training"}),e.jsxs("select",{value:O.training_id||"",onChange:l=>E(o=>({...o,[a.candidateId]:{...o[a.candidateId],training_id:l.target.value}})),disabled:se,style:{width:"100%"},children:[e.jsx("option",{value:"",children:"Selectâ€¦"}),ne.map(l=>e.jsxs("option",{value:l.training_id,children:[l.name," (",l.department,")"]},l.training_id))]})]}),e.jsxs("div",{style:{minWidth:160},children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"Due Date"}),e.jsx("input",{type:"date",value:O.due_date||"",onChange:l=>E(o=>({...o,[a.candidateId]:{...o[a.candidateId],due_date:l.target.value}}))})]}),e.jsxs("button",{className:"button primary",type:"button",onClick:()=>ge(a),disabled:!!I||!X,children:[I===`${a.candidateId}:TRAINING_ASSIGN`?e.jsx(T,{size:14}):null,"Assign"]})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:1,minWidth:240},children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"Video Link (optional)"}),e.jsx("input",{value:O.video_link||"",onChange:l=>E(o=>({...o,[a.candidateId]:{...o[a.candidateId],video_link:l.target.value}})),placeholder:"If blank, template link will be used",style:{width:"100%"}})]}),e.jsxs("div",{style:{flex:1,minWidth:240},children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"Description (optional)"}),e.jsx("input",{value:O.description||"",onChange:l=>E(o=>({...o,[a.candidateId]:{...o[a.candidateId],description:l.target.value}})),placeholder:"If blank, template description will be used",style:{width:"100%"}})]})]}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{children:[e.jsx("label",{className:"small",style:{display:"block",marginBottom:4},children:"Documents (one URL or Drive fileId per line, optional)"}),e.jsx("textarea",{value:O.documentsLines||"",onChange:l=>E(o=>({...o,[a.candidateId]:{...o[a.candidateId],documentsLines:l.target.value}})),rows:2,style:{width:"100%"}})]})]}):null,e.jsx("div",{style:{height:12}}),e.jsx(Pe,{items:D,token:c,loading:W,canUpdate:Ie&&!I,onStart:l=>ue(a.candidateId,l),onComplete:l=>pe(a.candidateId,l)})]})]},`${a.requirementId}:${a.candidateId}`)})})})]})}export{Je as ProbationPage};
