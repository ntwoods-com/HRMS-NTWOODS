import{y as b,z as _,r,j as e,n as d}from"./index-grL27em3.js";function q({token:t}={}){return b("TEST_TOKEN_VALIDATE",{token:t},null)}function I({token:t}={}){return b("TEST_QUESTIONS_GET",{token:t},null)}function P({token:t,fullName:a,applyingFor:c,source:m,answers:n}={}){return b("TEST_SUBMIT_PUBLIC",{token:t,fullName:a,applyingFor:c,source:m,answers:n},null)}function k(t){if(!t)return"";const a=t instanceof Date?t:new Date(t);return Number.isNaN(a.getTime())?String(t):a.toLocaleString()}function M(){const t=_(),a=r.useMemo(()=>new URLSearchParams(t.search).get("token")||"",[t.search]),[c,m]=r.useState(!0),[n,N]=r.useState(!1),[F,h]=r.useState(!1),[T,p]=r.useState(""),[C,o]=r.useState(!1),[A,u]=r.useState(""),[g,f]=r.useState([]),[x,w]=r.useState(""),[S,L]=r.useState(""),[j,D]=r.useState(""),[v,y]=r.useState({});r.useEffect(()=>{let s=!1;async function l(){m(!0);try{if(!a){if(s)return;h(!1),p(""),o(!1),u(""),f([]),y({});return}const i=await q({token:a});if(s||(h(!!i.valid),p(i.expiresAt||""),o(!!i.submitted),u(""),f([]),y({}),!i.valid||i.submitted))return;const E=await I({token:a});if(s)return;if(E.alreadySubmitted){o(!0),u("");return}f(E.questions||[])}catch(i){if(s)return;h(!1),p(""),o(!1),u(""),f([]),d.error((i==null?void 0:i.message)||"Failed to load test")}finally{s||m(!1)}}return l(),()=>{s=!0}},[a]);async function U(){if(!(c||n))try{if(!a)return;if(!String(x).trim()){d.error("Full Name required");return}if(!String(S).trim()){d.error("Applying For required");return}if(!String(j).trim()){d.error("Source required");return}for(const l of g){const i=v[l.id];if(!String(i??"").trim()){d.error(`Answer required for question ${l.id}`);return}}N(!0);const s=await P({token:a,fullName:String(x).trim(),applyingFor:String(S).trim(),source:String(j).trim(),answers:v});o(!0),u((s==null?void 0:s.submittedAt)||""),d.success("Test submitted")}catch(s){const l=(s==null?void 0:s.message)||"Submit failed";String(l).toUpperCase().includes("ALREADY_SUBMITTED")&&o(!0),d.error(l)}finally{N(!1)}}return e.jsx("div",{className:"container",style:{maxWidth:860},children:e.jsxs("div",{className:"card",style:{marginTop:10},children:[e.jsx("h2",{style:{marginTop:0},children:"Online Test"}),c?e.jsx("div",{className:"small",children:"Loading..."}):a?F?C?e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsx("strong",{children:"Test submitted"}),e.jsx("div",{className:"small",style:{marginTop:8},children:"Thank you. Your response has been submitted."}),A?e.jsxs("div",{className:"small",style:{marginTop:6},children:["Submitted: ",k(A)]}):null]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"small",children:["Token valid",T?` (expires: ${k(T)})`:""]}),e.jsx("div",{style:{height:12}}),e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsx("strong",{children:"Candidate Details"}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("div",{className:"small",children:"Full Name"}),e.jsx("input",{value:x,onChange:s=>w(s.target.value),placeholder:"Full Name",disabled:n})]}),e.jsxs("div",{children:[e.jsx("div",{className:"small",children:"Applying For"}),e.jsx("input",{value:S,onChange:s=>L(s.target.value),placeholder:"Applying For",disabled:n})]}),e.jsxs("div",{children:[e.jsx("div",{className:"small",children:"Source"}),e.jsx("input",{value:j,onChange:s=>D(s.target.value),placeholder:"Source",disabled:n})]})]})]}),e.jsx("div",{style:{height:12}}),e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsx("strong",{children:"Questions"}),e.jsx("div",{style:{height:10}}),g.length===0?e.jsx("div",{className:"small",children:"No questions loaded."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:g.map(s=>e.jsxs("div",{className:"card",style:{background:"#fff"},children:[e.jsxs("div",{style:{fontWeight:700},children:[s.id,"."]}),e.jsx("div",{className:"small",style:{marginTop:6},children:s.prompt}),e.jsx("div",{style:{height:8}}),e.jsx("input",{value:v[s.id]??"",onChange:l=>y(i=>({...i,[s.id]:l.target.value})),placeholder:"Your answer",disabled:n})]},s.id))}),e.jsx("div",{style:{height:12}}),e.jsx("button",{className:"button primary",type:"button",onClick:U,disabled:n||g.length===0,children:n?"Submitting...":"Submit Test"})]}),e.jsx("div",{className:"small",style:{marginTop:12},children:"Do not refresh after submit. One attempt only."})]}):e.jsx("div",{className:"small",children:"Invalid or expired token."}):e.jsx("div",{className:"small",children:"Missing token in URL."})]})})}export{M as PublicTestPage};
