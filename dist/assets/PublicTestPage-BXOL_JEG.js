import{I as L,J as K,r as s,n as a,j as e}from"./index-3pZLK3h4.js";function M({token:r}={}){return L("TEST_TOKEN_VALIDATE",{token:r},null)}function W({token:r}={}){return L("TEST_QUESTIONS_GET",{token:r},null)}function Y({token:r,fullName:n,applyingFor:o,source:u,answers:d}={}){return L("TEST_SUBMIT_PUBLIC",{token:r,fullName:n,applyingFor:o,source:u,answers:d},null)}function F(r){if(!r)return"";const n=r instanceof Date?r:new Date(r);return Number.isNaN(n.getTime())?String(r):n.toLocaleString()}function O(r,n){const o=s.useRef(0),u=3;return s.useEffect(()=>{if(!r)return;const d=()=>{document.hidden&&(o.current+=1,n&&n(o.current,u),a.error(`‚ö†Ô∏è Warning ${o.current}/${u}: Do not switch tabs during the test!`))},v=()=>{o.current+=1,n&&n(o.current,u),a.error(`‚ö†Ô∏è Warning ${o.current}/${u}: Do not leave the test window!`)},S=i=>{i.preventDefault(),a.error("Right-click is disabled during the test")},h=i=>{i.preventDefault(),a.error("Copy is disabled during the test")},p=i=>{(i.ctrlKey&&["c","v","a","u","s"].includes(i.key.toLowerCase())||i.key==="F12"||i.ctrlKey&&i.shiftKey&&["i","j","c"].includes(i.key.toLowerCase()))&&(i.preventDefault(),a.error("This action is disabled during the test"))},g=i=>(i.preventDefault(),i.returnValue="You have an ongoing test. Are you sure you want to leave?",i.returnValue);return document.addEventListener("visibilitychange",d),window.addEventListener("blur",v),document.addEventListener("contextmenu",S),document.addEventListener("copy",h),document.addEventListener("keydown",p),window.addEventListener("beforeunload",g),()=>{document.removeEventListener("visibilitychange",d),window.removeEventListener("blur",v),document.removeEventListener("contextmenu",S),document.removeEventListener("copy",h),document.removeEventListener("keydown",p),window.removeEventListener("beforeunload",g)}},[r,n]),{violationCount:o.current,maxViolations:u}}function G(){const r=K(),n=s.useMemo(()=>new URLSearchParams(r.search).get("token")||"",[r.search]),[o,u]=s.useState(!0),[d,v]=s.useState(!1),[S,h]=s.useState(!1),[p,g]=s.useState(""),[i,f]=s.useState(!1),[C,b]=s.useState(""),[w,N]=s.useState([]),[T,B]=s.useState(!1),[A,R]=s.useState(0),[m,I]=s.useState(!1),[x,P]=s.useState(""),[y,U]=s.useState(""),[j,_]=s.useState(""),[k,E]=s.useState({}),q=s.useCallback((t,c)=>{R(t),t>=c&&(B(!0),a.error("Test blocked due to multiple tab switches. Contact HR."))},[]);O(m&&!i&&!T,q),s.useEffect(()=>{let t=!1;async function c(){u(!0);try{if(!n){if(t)return;h(!1),g(""),f(!1),b(""),N([]),E({});return}const l=await M({token:n});if(t||(h(!!l.valid),g(l.expiresAt||""),f(!!l.submitted),b(""),N([]),E({}),!l.valid||l.submitted))return;const D=await W({token:n});if(t)return;if(D.alreadySubmitted){f(!0),b("");return}N(D.questions||[])}catch(l){if(t)return;h(!1),g(""),f(!1),b(""),N([]),a.error((l==null?void 0:l.message)||"Failed to load test")}finally{t||u(!1)}}return c(),()=>{t=!0}},[n]);async function V(){if(!(o||d))try{if(!n)return;if(!String(x).trim()){a.error("Full Name required");return}if(!String(y).trim()){a.error("Applying For required");return}if(!String(j).trim()){a.error("Source required");return}for(const c of w){const l=k[c.id];if(!String(l??"").trim()){a.error(`Answer required for question ${c.id}`);return}}v(!0);const t=await Y({token:n,fullName:String(x).trim(),applyingFor:String(y).trim(),source:String(j).trim(),answers:k});f(!0),b((t==null?void 0:t.submittedAt)||""),a.success("Test submitted")}catch(t){const c=(t==null?void 0:t.message)||"Submit failed";String(c).toUpperCase().includes("ALREADY_SUBMITTED")&&f(!0),a.error(c)}finally{v(!1)}}const $=()=>{if(!x.trim()||!y.trim()||!j.trim()){a.error("Please fill all candidate details before starting the test");return}I(!0),a.success("Test started! Do not switch tabs or leave this window.")};return e.jsxs("div",{className:"container",style:{maxWidth:860,userSelect:m?"none":"auto"},children:[T&&e.jsxs("div",{className:"test-blocked-overlay",children:[e.jsx("div",{className:"test-blocked-icon",children:"üö´"}),e.jsx("div",{className:"test-blocked-title",children:"Test Blocked"}),e.jsx("div",{className:"test-blocked-message",children:"Your test has been blocked due to multiple tab switches or leaving the test window. Please contact HR for further assistance."})]}),e.jsxs("div",{className:"card",style:{marginTop:10},children:[e.jsx("h2",{style:{marginTop:0},children:"Online Test"}),o?e.jsx("div",{className:"small",children:"Loading..."}):n?S?i?e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsx("strong",{children:"Test submitted"}),e.jsx("div",{className:"small",style:{marginTop:8},children:"Thank you. Your response has been submitted."}),C?e.jsxs("div",{className:"small",style:{marginTop:6},children:["Submitted: ",F(C)]}):null]}):e.jsxs(e.Fragment,{children:[m&&!T&&e.jsxs("div",{className:"test-warning-banner",children:[e.jsx("div",{className:"test-warning-icon",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"test-warning-content",children:[e.jsx("div",{className:"test-warning-title",children:"Important: Do not leave this page!"}),e.jsxs("div",{className:"test-warning-text",children:["Switching tabs, minimizing browser, or leaving this window will be recorded. After 3 violations, your test will be blocked.",A>0&&e.jsxs("strong",{style:{display:"block",marginTop:4,color:"#dc2626"},children:["Violations: ",A,"/3"]})]})]})]}),e.jsxs("div",{className:"small",children:["Token valid",p?` (expires: ${F(p)})`:""]}),e.jsx("div",{style:{height:12}}),e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsx("strong",{children:"Candidate Details"}),e.jsx("div",{style:{height:10}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"small",children:["Full Name ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{value:x,onChange:t=>P(t.target.value),placeholder:"Full Name",disabled:d||m})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"small",children:["Applying For ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{value:y,onChange:t=>U(t.target.value),placeholder:"Applying For",disabled:d||m})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"small",children:["Source ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{value:j,onChange:t=>_(t.target.value),placeholder:"Source",disabled:d||m})]})]}),!m&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("button",{className:"button primary",type:"button",onClick:$,disabled:!x.trim()||!y.trim()||!j.trim(),children:"‚ñ∂ Start Test"}),e.jsx("div",{className:"small",style:{marginTop:8,color:"var(--gray-500)"},children:"Fill your details above and click Start Test to begin"})]})]}),m&&!T&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:12}}),e.jsxs("div",{className:"card",style:{background:"#fafafa"},children:[e.jsx("strong",{children:"Questions"}),e.jsx("div",{style:{height:10}}),w.length===0?e.jsx("div",{className:"small",children:"No questions loaded."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:w.map(t=>e.jsxs("div",{className:"card",style:{background:"#fff"},children:[e.jsxs("div",{style:{fontWeight:700},children:[t.id,"."]}),e.jsx("div",{className:"small",style:{marginTop:6},children:t.prompt}),e.jsx("div",{style:{height:8}}),e.jsx("input",{value:k[t.id]??"",onChange:c=>E(l=>({...l,[t.id]:c.target.value})),placeholder:"Your answer",disabled:d})]},t.id))}),e.jsx("div",{style:{height:12}}),e.jsx("button",{className:"button primary",type:"button",onClick:V,disabled:d||w.length===0,children:d?"Submitting...":"Submit Test"})]}),e.jsx("div",{className:"small",style:{marginTop:12,color:"#ef4444",fontWeight:500},children:"‚ö†Ô∏è Do not refresh, switch tabs, or leave this page. One attempt only."})]})]}):e.jsx("div",{className:"small",children:"Invalid or expired token."}):e.jsx("div",{className:"small",children:"Missing token in URL."})]})]})}export{G as PublicTestPage};
