import{r as V}from"./index-grL27em3.js";const x="Asia/Kolkata";function L(t){return String(t||"").trim().toUpperCase().replace(/\s+/g,"_")}function N(t){if(!t)return null;const n=(t instanceof Date?t:new Date(t)).getTime();return Number.isNaN(n)?null:n}function h(t){if(!Number.isFinite(t))return"-";const e=Math.abs(t),n=Math.floor(e/1e3),r=Math.floor(n/(3600*24)),a=Math.floor(n%(3600*24)/3600),c=Math.floor(n%3600/60),M=n%60,l=String(a).padStart(2,"0"),d=String(c).padStart(2,"0"),s=String(M).padStart(2,"0");return r?`${r}d ${l}:${d}:${s}`:`${l}:${d}:${s}`}function z(t,{timeZone:e=x}={}){const n=N(t);if(n==null)return"";const r=new Date(n);try{return new Intl.DateTimeFormat("en-IN",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).format(r).replace(",","").replace(/\//g,"-")}catch{return r.toLocaleString()}}function q({sla:t,stepKey:e,stepStartAt:n,plannedMinutes:r,deadlineAt:a,nowMs:c,timeZone:M=x,dueSoonMs:l=10*60*1e3}={}){const d=Number.isFinite(c)?c:Date.now(),s=L((t==null?void 0:t.stepName)||e||""),i=Number((t==null?void 0:t.plannedMinutes)??r??0)||0,$=(t==null?void 0:t.startAt)||n||"",b=N($),y=(t==null?void 0:t.deadlineAt)||a||"",D=N(y),f=D??(i>0&&b!=null?b+i*60*1e3:null),v=i>0,_=f!=null;if(!v)return{stepName:s,plannedMinutes:i,hasSla:!1,reason:"NO_SLA_CONFIG",deadlineAt:"",remainingMs:null,isOverdue:!1,status:null,badgeVariant:"gray",badgeText:"No SLA",deadlineText:"",plannedText:""};if(!_)return{stepName:s,plannedMinutes:i,hasSla:!1,reason:"MISSING_START_TIME",deadlineAt:"",remainingMs:null,isOverdue:!1,status:null,badgeVariant:"gray",badgeText:"SLA pending",deadlineText:"",plannedText:`Planned: ${i}m`};const u=f-d,g=u<=0,S=g?"OVERDUE":u<=l?"DUE_SOON":"ON_TIME",U=S==="OVERDUE"?"red":S==="DUE_SOON"?"orange":"green",k=g?`OVERDUE by ${h(-u)}`:`${h(u)} left`,F=`Due at: ${z(f,{timeZone:M})||"-"}`,R=`Planned: ${i}m`;return{stepName:s,plannedMinutes:i,hasSla:!0,reason:"",deadlineAt:new Date(f).toISOString(),remainingMs:u,isOverdue:g,status:S,badgeVariant:U,badgeText:k,deadlineText:F,plannedText:R}}let A=Date.now(),o=null,m=1e3;const p=new Set,T=new Map;function G(){A=Date.now(),p.forEach(t=>{try{t()}catch{}})}function K(){let t=1e3;return T.forEach(e=>{const n=Number(e)||1e3;n>0&&n<t&&(t=n)}),t}function w(){o==null&&(o=setInterval(G,m))}function E(){o!=null&&(clearInterval(o),o=null)}function I(){if(p.size===0){E();return}const t=K();if(o==null){m=t,w();return}t!==m&&(m=t,E(),w())}function P(t,{intervalMs:e=1e3}={}){return typeof t!="function"?()=>{}:(p.add(t),T.set(t,Number(e)||1e3),I(),()=>{p.delete(t),T.delete(t),I()})}function Z(){return A}function O(){return Date.now()}function B({intervalMs:t=1e3,enabled:e=!0}={}){const n=e!==!1,r=a=>P(a,{intervalMs:Number(t)||1e3});return V.useSyncExternalStore(n?r:()=>()=>{},n?Z:O,O)}export{z as a,q as d,h as f,N as t,B as u};
